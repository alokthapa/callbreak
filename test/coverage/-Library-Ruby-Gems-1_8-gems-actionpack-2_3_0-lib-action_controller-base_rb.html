<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'><head><title>/Library/Ruby/Gems/1.8/gems/actionpack-2.3.0/lib/action_controller/base.rb - C0 code coverage information</title>
    <style type='text/css'>body { background-color: rgb(240, 240, 245); }</style>
    <style type='text/css'>span.cross-ref-title {
 font-size: 140%;
}
span.cross-ref a {
 text-decoration: none;
}
span.cross-ref {
 background-color:#f3f7fa;
 border: 1px dashed #333;
 margin: 1em;
 padding: 0.5em;
 overflow: hidden;
}
a.crossref-toggle {
 text-decoration: none;
}
span.marked0 {
 background-color: rgb(185, 210, 200);
 display: block;
}
span.marked1 {
 background-color: rgb(190, 215, 205);
 display: block;
}
span.inferred0 {
 background-color: rgb(175, 200, 200);
 display: block;
}
span.inferred1 {
 background-color: rgb(180, 205, 205);
 display: block;
}
span.uncovered0 {
 background-color: rgb(225, 110, 110);
 display: block;
}
span.uncovered1 {
 background-color: rgb(235, 120, 120);
 display: block;
}
span.overview {
 border-bottom: 8px solid black;
}
div.overview {
 border-bottom: 8px solid black;
}
body {
 font-family: verdana, arial, helvetica;
}
div.footer {
 font-size: 68%;
 margin-top: 1.5em;
}
h1, h2, h3, h4, h5, h6 {
 margin-bottom: 0.5em;
}
h5 {
 margin-top: 0.5em;
}
.hidden {
 display: none;
}
div.separator {
 height: 10px;
}
/* Commented out for better readability, esp. on IE */
/*
table tr td, table tr th {
 font-size: 68%;
}
td.value table tr td {
 font-size: 11px;
}
*/
table.percent_graph {
 height: 12px;
 border: #808080 1px solid;
 empty-cells: show;
}
table.percent_graph td.covered {
 height: 10px;
 background: #00f000;
}
table.percent_graph td.uncovered {
 height: 10px;
 background: #e00000;
}
table.percent_graph td.NA {
 height: 10px;
 background: #eaeaea;
}
table.report {
 border-collapse: collapse;
 width: 100%;
}
table.report td.heading {
 background: #dcecff;
 border: #d0d0d0 1px solid;
 font-weight: bold;
 text-align: center;
}
table.report td.heading:hover {
 background: #c0ffc0;
}
table.report td.text {
 border: #d0d0d0 1px solid;
}
table.report td.value,
table.report td.lines_total,
table.report td.lines_code {
 text-align: right;
 border: #d0d0d0 1px solid;
}
table.report tr.light {
 background-color: rgb(240, 240, 245);
}
table.report tr.dark {
 background-color: rgb(230, 230, 235);
}
</style>
    <script type='text/javascript'>
// <![CDATA[
  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make cross-references hidden by default
  document.writeln( "<style type=\"text/css\">span.cross-ref { display: none }</style>" )
  // ]]>
</script>
    <style type='text/css'>span.run0 {
  background-color: rgb(178, 204, 255);
  display: block;
}
span.run1 {
  background-color: rgb(178, 206, 255);
  display: block;
}
span.run2 {
  background-color: rgb(178, 209, 255);
  display: block;
}
span.run3 {
  background-color: rgb(178, 211, 255);
  display: block;
}
span.run4 {
  background-color: rgb(178, 214, 255);
  display: block;
}
span.run5 {
  background-color: rgb(178, 218, 255);
  display: block;
}
span.run6 {
  background-color: rgb(178, 220, 255);
  display: block;
}
span.run7 {
  background-color: rgb(178, 223, 255);
  display: block;
}
span.run8 {
  background-color: rgb(178, 225, 255);
  display: block;
}
span.run9 {
  background-color: rgb(178, 228, 255);
  display: block;
}
span.run10 {
  background-color: rgb(178, 232, 255);
  display: block;
}
span.run11 {
  background-color: rgb(178, 234, 255);
  display: block;
}
span.run12 {
  background-color: rgb(178, 237, 255);
  display: block;
}
span.run13 {
  background-color: rgb(178, 239, 255);
  display: block;
}
span.run14 {
  background-color: rgb(178, 242, 255);
  display: block;
}
span.run15 {
  background-color: rgb(178, 246, 255);
  display: block;
}
span.run16 {
  background-color: rgb(178, 248, 255);
  display: block;
}
span.run17 {
  background-color: rgb(178, 251, 255);
  display: block;
}
span.run18 {
  background-color: rgb(178, 253, 255);
  display: block;
}
span.run19 {
  background-color: rgb(178, 255, 253);
  display: block;
}
span.run20 {
  background-color: rgb(178, 255, 249);
  display: block;
}
span.run21 {
  background-color: rgb(178, 255, 247);
  display: block;
}
span.run22 {
  background-color: rgb(178, 255, 244);
  display: block;
}
span.run23 {
  background-color: rgb(178, 255, 242);
  display: block;
}
span.run24 {
  background-color: rgb(178, 255, 239);
  display: block;
}
span.run25 {
  background-color: rgb(178, 255, 235);
  display: block;
}
span.run26 {
  background-color: rgb(178, 255, 233);
  display: block;
}
span.run27 {
  background-color: rgb(178, 255, 230);
  display: block;
}
span.run28 {
  background-color: rgb(178, 255, 228);
  display: block;
}
span.run29 {
  background-color: rgb(178, 255, 225);
  display: block;
}
span.run30 {
  background-color: rgb(178, 255, 221);
  display: block;
}
span.run31 {
  background-color: rgb(178, 255, 219);
  display: block;
}
span.run32 {
  background-color: rgb(178, 255, 216);
  display: block;
}
span.run33 {
  background-color: rgb(178, 255, 214);
  display: block;
}
span.run34 {
  background-color: rgb(178, 255, 211);
  display: block;
}
span.run35 {
  background-color: rgb(178, 255, 207);
  display: block;
}
span.run36 {
  background-color: rgb(178, 255, 205);
  display: block;
}
span.run37 {
  background-color: rgb(178, 255, 202);
  display: block;
}
span.run38 {
  background-color: rgb(178, 255, 200);
  display: block;
}
span.run39 {
  background-color: rgb(178, 255, 197);
  display: block;
}
span.run40 {
  background-color: rgb(178, 255, 193);
  display: block;
}
span.run41 {
  background-color: rgb(178, 255, 191);
  display: block;
}
span.run42 {
  background-color: rgb(178, 255, 188);
  display: block;
}
span.run43 {
  background-color: rgb(178, 255, 186);
  display: block;
}
span.run44 {
  background-color: rgb(178, 255, 183);
  display: block;
}
span.run45 {
  background-color: rgb(178, 255, 179);
  display: block;
}
span.run46 {
  background-color: rgb(179, 255, 178);
  display: block;
}
span.run47 {
  background-color: rgb(182, 255, 178);
  display: block;
}
span.run48 {
  background-color: rgb(184, 255, 178);
  display: block;
}
span.run49 {
  background-color: rgb(187, 255, 178);
  display: block;
}
span.run50 {
  background-color: rgb(191, 255, 178);
  display: block;
}
span.run51 {
  background-color: rgb(193, 255, 178);
  display: block;
}
span.run52 {
  background-color: rgb(196, 255, 178);
  display: block;
}
span.run53 {
  background-color: rgb(198, 255, 178);
  display: block;
}
span.run54 {
  background-color: rgb(201, 255, 178);
  display: block;
}
span.run55 {
  background-color: rgb(205, 255, 178);
  display: block;
}
span.run56 {
  background-color: rgb(207, 255, 178);
  display: block;
}
span.run57 {
  background-color: rgb(210, 255, 178);
  display: block;
}
span.run58 {
  background-color: rgb(212, 255, 178);
  display: block;
}
span.run59 {
  background-color: rgb(215, 255, 178);
  display: block;
}
span.run60 {
  background-color: rgb(219, 255, 178);
  display: block;
}
span.run61 {
  background-color: rgb(221, 255, 178);
  display: block;
}
span.run62 {
  background-color: rgb(224, 255, 178);
  display: block;
}
span.run63 {
  background-color: rgb(226, 255, 178);
  display: block;
}
span.run64 {
  background-color: rgb(229, 255, 178);
  display: block;
}
span.run65 {
  background-color: rgb(233, 255, 178);
  display: block;
}
span.run66 {
  background-color: rgb(235, 255, 178);
  display: block;
}
span.run67 {
  background-color: rgb(238, 255, 178);
  display: block;
}
span.run68 {
  background-color: rgb(240, 255, 178);
  display: block;
}
span.run69 {
  background-color: rgb(243, 255, 178);
  display: block;
}
span.run70 {
  background-color: rgb(247, 255, 178);
  display: block;
}
span.run71 {
  background-color: rgb(249, 255, 178);
  display: block;
}
span.run72 {
  background-color: rgb(252, 255, 178);
  display: block;
}
span.run73 {
  background-color: rgb(255, 255, 178);
  display: block;
}
span.run74 {
  background-color: rgb(255, 252, 178);
  display: block;
}
span.run75 {
  background-color: rgb(255, 248, 178);
  display: block;
}
span.run76 {
  background-color: rgb(255, 246, 178);
  display: block;
}
span.run77 {
  background-color: rgb(255, 243, 178);
  display: block;
}
span.run78 {
  background-color: rgb(255, 240, 178);
  display: block;
}
span.run79 {
  background-color: rgb(255, 238, 178);
  display: block;
}
span.run80 {
  background-color: rgb(255, 234, 178);
  display: block;
}
span.run81 {
  background-color: rgb(255, 232, 178);
  display: block;
}
span.run82 {
  background-color: rgb(255, 229, 178);
  display: block;
}
span.run83 {
  background-color: rgb(255, 226, 178);
  display: block;
}
span.run84 {
  background-color: rgb(255, 224, 178);
  display: block;
}
span.run85 {
  background-color: rgb(255, 220, 178);
  display: block;
}
span.run86 {
  background-color: rgb(255, 218, 178);
  display: block;
}
span.run87 {
  background-color: rgb(255, 215, 178);
  display: block;
}
span.run88 {
  background-color: rgb(255, 212, 178);
  display: block;
}
span.run89 {
  background-color: rgb(255, 210, 178);
  display: block;
}
span.run90 {
  background-color: rgb(255, 206, 178);
  display: block;
}
span.run91 {
  background-color: rgb(255, 204, 178);
  display: block;
}
span.run92 {
  background-color: rgb(255, 201, 178);
  display: block;
}
span.run93 {
  background-color: rgb(255, 198, 178);
  display: block;
}
span.run94 {
  background-color: rgb(255, 196, 178);
  display: block;
}
span.run95 {
  background-color: rgb(255, 192, 178);
  display: block;
}
span.run96 {
  background-color: rgb(255, 189, 178);
  display: block;
}
span.run97 {
  background-color: rgb(255, 187, 178);
  display: block;
}
span.run98 {
  background-color: rgb(255, 184, 178);
  display: block;
}
span.run99 {
  background-color: rgb(255, 182, 178);
  display: block;
}
span.run100 {
  background-color: rgb(255, 178, 178);
  display: block;
}
</style>
    </head>
  <body><h3>C0 code coverage information</h3>
    <p>Generated on Fri Apr 10 14:55:19 -0500 2009 with <a href='http://eigenclass.org/hiki/rcov'>rcov 0.8.1.2</a>
      </p>
    <hr/>
    <pre><span class='marked0'>Code reported as executed by Ruby looks like this...
</span><span class='marked1'>and this: this line is also marked as covered.
</span><span class='inferred0'>Lines considered as run by rcov, but not reported by Ruby, look like this,
</span><span class='inferred1'>and this: these lines were inferred by rcov (using simple heuristics).
</span><span class='uncovered0'>Finally, here&apos;s a line marked as not executed.
</span></pre>                       
<table class='report'><thead><tr><td class='heading'>Name</td>
      <td class='heading'>Total lines</td>
      <td class='heading'>Lines of code</td>
      <td class='heading'>Total coverage</td>
      <td class='heading'>Code coverage</td>
      </tr>
    </thead>
  <tbody><tr class='light'><td><a href='-Library-Ruby-Gems-1_8-gems-actionpack-2_3_0-lib-action_controller-base_rb.html'>/Library/Ruby/Gems/1.8/gems/actionpack-2.3.0/lib/action_controller/base.rb</a>
        </td>
      <td class='lines_total'><tt>1353</tt>
        </td>
      <td class='lines_code'><tt>526</tt>
        </td>
      <td><table cellspacing='0' cellpadding='0' align='right'><tr><td><tt class='coverage_total'>69.5%</tt>
              &nbsp;</td>
            <td><table cellspacing='0' class='percent_graph' cellpadding='0' width='100'><tr><td class='covered' width='70'/>
                  <td class='uncovered' width='30'/>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
      <td><table cellspacing='0' cellpadding='0' align='right'><tr><td><tt class='coverage_code'>31.4%</tt>
              &nbsp;</td>
            <td><table cellspacing='0' class='percent_graph' cellpadding='0' width='100'><tr><td class='covered' width='31'/>
                  <td class='uncovered' width='69'/>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </tbody>
  </table>
<pre><span class="marked0"><a name="line1"></a>   1 require 'set'
</span><span class="inferred1"><a name="line2"></a>   2 
</span><span class="marked0"><a name="line3"></a>   3 module ActionController #:nodoc:
</span><span class="marked1"><a name="line4"></a>   4   class ActionControllerError &lt; StandardError #:nodoc:
</span><span class="inferred0"><a name="line5"></a>   5   end
</span><span class="inferred1"><a name="line6"></a>   6 
</span><span class="marked0"><a name="line7"></a>   7   class SessionRestoreError &lt; ActionControllerError #:nodoc:
</span><span class="inferred1"><a name="line8"></a>   8   end
</span><span class="inferred0"><a name="line9"></a>   9 
</span><span class="marked1"><a name="line10"></a>  10   class RenderError &lt; ActionControllerError #:nodoc:
</span><span class="inferred0"><a name="line11"></a>  11   end
</span><span class="inferred1"><a name="line12"></a>  12 
</span><span class="marked0"><a name="line13"></a>  13   class RoutingError &lt; ActionControllerError #:nodoc:
</span><span class="marked1"><a name="line14"></a>  14     attr_reader :failures
</span><span class="marked0"><a name="line15"></a>  15     def initialize(message, failures=[])
</span><span class="uncovered1"><a name="line16"></a>  16       super(message)
</span><span class="uncovered0"><a name="line17"></a>  17       @failures = failures
</span><span class="uncovered1"><a name="line18"></a>  18     end
</span><span class="uncovered0"><a name="line19"></a>  19   end
</span><span class="inferred1"><a name="line20"></a>  20 
</span><span class="marked0"><a name="line21"></a>  21   class MethodNotAllowed &lt; ActionControllerError #:nodoc:
</span><span class="marked1"><a name="line22"></a>  22     attr_reader :allowed_methods
</span><span class="inferred0"><a name="line23"></a>  23 
</span><span class="marked1"><a name="line24"></a>  24     def initialize(*allowed_methods)
</span><span class="uncovered0"><a name="line25"></a>  25       super(&quot;Only #{allowed_methods.to_sentence} requests are allowed.&quot;)
</span><span class="uncovered1"><a name="line26"></a>  26       @allowed_methods = allowed_methods
</span><span class="uncovered0"><a name="line27"></a>  27     end
</span><span class="inferred1"><a name="line28"></a>  28 
</span><span class="marked0"><a name="line29"></a>  29     def allowed_methods_header
</span><span class="uncovered1"><a name="line30"></a>  30       allowed_methods.map { |method_symbol| method_symbol.to_s.upcase } * ', '
</span><span class="uncovered0"><a name="line31"></a>  31     end
</span><span class="inferred1"><a name="line32"></a>  32 
</span><span class="marked0"><a name="line33"></a>  33     def handle_response!(response)
</span><span class="uncovered1"><a name="line34"></a>  34       response.headers['Allow'] ||= allowed_methods_header
</span><span class="uncovered0"><a name="line35"></a>  35     end
</span><span class="uncovered1"><a name="line36"></a>  36   end
</span><span class="inferred0"><a name="line37"></a>  37 
</span><span class="marked1"><a name="line38"></a>  38   class NotImplemented &lt; MethodNotAllowed #:nodoc:
</span><span class="inferred0"><a name="line39"></a>  39   end
</span><span class="inferred1"><a name="line40"></a>  40 
</span><span class="marked0"><a name="line41"></a>  41   class UnknownController &lt; ActionControllerError #:nodoc:
</span><span class="inferred1"><a name="line42"></a>  42   end
</span><span class="inferred0"><a name="line43"></a>  43 
</span><span class="marked1"><a name="line44"></a>  44   class UnknownAction &lt; ActionControllerError #:nodoc:
</span><span class="inferred0"><a name="line45"></a>  45   end
</span><span class="inferred1"><a name="line46"></a>  46 
</span><span class="marked0"><a name="line47"></a>  47   class MissingFile &lt; ActionControllerError #:nodoc:
</span><span class="inferred1"><a name="line48"></a>  48   end
</span><span class="inferred0"><a name="line49"></a>  49 
</span><span class="marked1"><a name="line50"></a>  50   class RenderError &lt; ActionControllerError #:nodoc:
</span><span class="inferred0"><a name="line51"></a>  51   end
</span><span class="inferred1"><a name="line52"></a>  52 
</span><span class="marked0"><a name="line53"></a>  53   class SessionOverflowError &lt; ActionControllerError #:nodoc:
</span><span class="marked1"><a name="line54"></a>  54     DEFAULT_MESSAGE = 'Your session data is larger than the data column in which it is to be stored. You must increase the size of your data column if you intend to store large data.'
</span><span class="inferred0"><a name="line55"></a>  55 
</span><span class="marked1"><a name="line56"></a>  56     def initialize(message = nil)
</span><span class="uncovered0"><a name="line57"></a>  57       super(message || DEFAULT_MESSAGE)
</span><span class="uncovered1"><a name="line58"></a>  58     end
</span><span class="uncovered0"><a name="line59"></a>  59   end
</span><span class="inferred1"><a name="line60"></a>  60 
</span><span class="marked0"><a name="line61"></a>  61   class DoubleRenderError &lt; ActionControllerError #:nodoc:
</span><span class="marked1"><a name="line62"></a>  62     DEFAULT_MESSAGE = &quot;Render and/or redirect were called multiple times in this action. Please note that you may only call render OR redirect, and at most once per action. Also note that neither redirect nor render terminate execution of the action, so if you want to exit an action after redirecting, you need to do something like \&quot;redirect_to(...) and return\&quot;.&quot;
</span><span class="inferred0"><a name="line63"></a>  63 
</span><span class="marked1"><a name="line64"></a>  64     def initialize(message = nil)
</span><span class="uncovered0"><a name="line65"></a>  65       super(message || DEFAULT_MESSAGE)
</span><span class="uncovered1"><a name="line66"></a>  66     end
</span><span class="uncovered0"><a name="line67"></a>  67   end
</span><span class="inferred1"><a name="line68"></a>  68 
</span><span class="marked0"><a name="line69"></a>  69   class RedirectBackError &lt; ActionControllerError #:nodoc:
</span><span class="marked1"><a name="line70"></a>  70     DEFAULT_MESSAGE = 'No HTTP_REFERER was set in the request to this action, so redirect_to :back could not be called successfully. If this is a test, make sure to specify request.env[&quot;HTTP_REFERER&quot;].'
</span><span class="inferred0"><a name="line71"></a>  71 
</span><span class="marked1"><a name="line72"></a>  72     def initialize(message = nil)
</span><span class="uncovered0"><a name="line73"></a>  73       super(message || DEFAULT_MESSAGE)
</span><span class="uncovered1"><a name="line74"></a>  74     end
</span><span class="uncovered0"><a name="line75"></a>  75   end
</span><span class="inferred1"><a name="line76"></a>  76 
</span><span class="marked0"><a name="line77"></a>  77   class UnknownHttpMethod &lt; ActionControllerError #:nodoc:
</span><span class="inferred1"><a name="line78"></a>  78   end
</span><span class="inferred0"><a name="line79"></a>  79 
</span><span class="inferred1"><a name="line80"></a>  80   # Action Controllers are the core of a web request in Rails. They are made up of one or more actions that are executed
</span><span class="inferred0"><a name="line81"></a>  81   # on request and then either render a template or redirect to another action. An action is defined as a public method
</span><span class="inferred1"><a name="line82"></a>  82   # on the controller, which will automatically be made accessible to the web-server through Rails Routes.
</span><span class="inferred0"><a name="line83"></a>  83   #
</span><span class="inferred1"><a name="line84"></a>  84   # A sample controller could look like this:
</span><span class="inferred0"><a name="line85"></a>  85   #
</span><span class="inferred1"><a name="line86"></a>  86   #   class GuestBookController &lt; ActionController::Base
</span><span class="inferred0"><a name="line87"></a>  87   #     def index
</span><span class="inferred1"><a name="line88"></a>  88   #       @entries = Entry.find(:all)
</span><span class="inferred0"><a name="line89"></a>  89   #     end
</span><span class="inferred1"><a name="line90"></a>  90   #
</span><span class="inferred0"><a name="line91"></a>  91   #     def sign
</span><span class="inferred1"><a name="line92"></a>  92   #       Entry.create(params[:entry])
</span><span class="inferred0"><a name="line93"></a>  93   #       redirect_to :action =&gt; &quot;index&quot;
</span><span class="inferred1"><a name="line94"></a>  94   #     end
</span><span class="inferred0"><a name="line95"></a>  95   #   end
</span><span class="inferred1"><a name="line96"></a>  96   #
</span><span class="inferred0"><a name="line97"></a>  97   # Actions, by default, render a template in the &lt;tt&gt;app/views&lt;/tt&gt; directory corresponding to the name of the controller and action
</span><span class="inferred1"><a name="line98"></a>  98   # after executing code in the action. For example, the +index+ action of the GuestBookController would render the
</span><span class="inferred0"><a name="line99"></a>  99   # template &lt;tt&gt;app/views/guestbook/index.erb&lt;/tt&gt; by default after populating the &lt;tt&gt;@entries&lt;/tt&gt; instance variable.
</span><span class="inferred1"><a name="line100"></a> 100   #
</span><span class="inferred0"><a name="line101"></a> 101   # Unlike index, the sign action will not render a template. After performing its main purpose (creating a
</span><span class="inferred1"><a name="line102"></a> 102   # new entry in the guest book), it initiates a redirect instead. This redirect works by returning an external
</span><span class="inferred0"><a name="line103"></a> 103   # &quot;302 Moved&quot; HTTP response that takes the user to the index action.
</span><span class="inferred1"><a name="line104"></a> 104   #
</span><span class="inferred0"><a name="line105"></a> 105   # The index and sign represent the two basic action archetypes used in Action Controllers. Get-and-show and do-and-redirect.
</span><span class="inferred1"><a name="line106"></a> 106   # Most actions are variations of these themes.
</span><span class="inferred0"><a name="line107"></a> 107   #
</span><span class="inferred1"><a name="line108"></a> 108   # == Requests
</span><span class="inferred0"><a name="line109"></a> 109   #
</span><span class="inferred1"><a name="line110"></a> 110   # Requests are processed by the Action Controller framework by extracting the value of the &quot;action&quot; key in the request parameters.
</span><span class="inferred0"><a name="line111"></a> 111   # This value should hold the name of the action to be performed. Once the action has been identified, the remaining
</span><span class="inferred1"><a name="line112"></a> 112   # request parameters, the session (if one is available), and the full request with all the HTTP headers are made available to
</span><span class="inferred0"><a name="line113"></a> 113   # the action through instance variables. Then the action is performed.
</span><span class="inferred1"><a name="line114"></a> 114   #
</span><span class="inferred0"><a name="line115"></a> 115   # The full request object is available with the request accessor and is primarily used to query for HTTP headers. These queries
</span><span class="inferred1"><a name="line116"></a> 116   # are made by accessing the environment hash, like this:
</span><span class="inferred0"><a name="line117"></a> 117   #
</span><span class="inferred1"><a name="line118"></a> 118   #   def server_ip
</span><span class="inferred0"><a name="line119"></a> 119   #     location = request.env[&quot;SERVER_ADDR&quot;]
</span><span class="inferred1"><a name="line120"></a> 120   #     render :text =&gt; &quot;This server hosted at #{location}&quot;
</span><span class="inferred0"><a name="line121"></a> 121   #   end
</span><span class="inferred1"><a name="line122"></a> 122   #
</span><span class="inferred0"><a name="line123"></a> 123   # == Parameters
</span><span class="inferred1"><a name="line124"></a> 124   #
</span><span class="inferred0"><a name="line125"></a> 125   # All request parameters, whether they come from a GET or POST request, or from the URL, are available through the params method
</span><span class="inferred1"><a name="line126"></a> 126   # which returns a hash. For example, an action that was performed through &lt;tt&gt;/weblog/list?category=All&amp;limit=5&lt;/tt&gt; will include
</span><span class="inferred0"><a name="line127"></a> 127   # &lt;tt&gt;{ &quot;category&quot; =&gt; &quot;All&quot;, &quot;limit&quot; =&gt; 5 }&lt;/tt&gt; in params.
</span><span class="inferred1"><a name="line128"></a> 128   #
</span><span class="inferred0"><a name="line129"></a> 129   # It's also possible to construct multi-dimensional parameter hashes by specifying keys using brackets, such as:
</span><span class="inferred1"><a name="line130"></a> 130   #
</span><span class="inferred0"><a name="line131"></a> 131   #   &lt;input type=&quot;text&quot; name=&quot;post[name]&quot; value=&quot;david&quot;&gt;
</span><span class="inferred1"><a name="line132"></a> 132   #   &lt;input type=&quot;text&quot; name=&quot;post[address]&quot; value=&quot;hyacintvej&quot;&gt;
</span><span class="inferred0"><a name="line133"></a> 133   #
</span><span class="inferred1"><a name="line134"></a> 134   # A request stemming from a form holding these inputs will include &lt;tt&gt;{ &quot;post&quot; =&gt; { &quot;name&quot; =&gt; &quot;david&quot;, &quot;address&quot; =&gt; &quot;hyacintvej&quot; } }&lt;/tt&gt;.
</span><span class="inferred0"><a name="line135"></a> 135   # If the address input had been named &quot;post[address][street]&quot;, the params would have included
</span><span class="inferred1"><a name="line136"></a> 136   # &lt;tt&gt;{ &quot;post&quot; =&gt; { &quot;address&quot; =&gt; { &quot;street&quot; =&gt; &quot;hyacintvej&quot; } } }&lt;/tt&gt;. There's no limit to the depth of the nesting.
</span><span class="inferred0"><a name="line137"></a> 137   #
</span><span class="inferred1"><a name="line138"></a> 138   # == Sessions
</span><span class="inferred0"><a name="line139"></a> 139   #
</span><span class="inferred1"><a name="line140"></a> 140   # Sessions allows you to store objects in between requests. This is useful for objects that are not yet ready to be persisted,
</span><span class="inferred0"><a name="line141"></a> 141   # such as a Signup object constructed in a multi-paged process, or objects that don't change much and are needed all the time, such
</span><span class="inferred1"><a name="line142"></a> 142   # as a User object for a system that requires login. The session should not be used, however, as a cache for objects where it's likely
</span><span class="inferred0"><a name="line143"></a> 143   # they could be changed unknowingly. It's usually too much work to keep it all synchronized -- something databases already excel at.
</span><span class="inferred1"><a name="line144"></a> 144   #
</span><span class="inferred0"><a name="line145"></a> 145   # You can place objects in the session by using the &lt;tt&gt;session&lt;/tt&gt; method, which accesses a hash:
</span><span class="inferred1"><a name="line146"></a> 146   #
</span><span class="inferred0"><a name="line147"></a> 147   #   session[:person] = Person.authenticate(user_name, password)
</span><span class="inferred1"><a name="line148"></a> 148   #
</span><span class="inferred0"><a name="line149"></a> 149   # And retrieved again through the same hash:
</span><span class="inferred1"><a name="line150"></a> 150   #
</span><span class="inferred0"><a name="line151"></a> 151   #   Hello #{session[:person]}
</span><span class="inferred1"><a name="line152"></a> 152   #
</span><span class="inferred0"><a name="line153"></a> 153   # For removing objects from the session, you can either assign a single key to +nil+:
</span><span class="inferred1"><a name="line154"></a> 154   #
</span><span class="inferred0"><a name="line155"></a> 155   #   # removes :person from session
</span><span class="inferred1"><a name="line156"></a> 156   #   session[:person] = nil
</span><span class="inferred0"><a name="line157"></a> 157   #
</span><span class="inferred1"><a name="line158"></a> 158   # or you can remove the entire session with +reset_session+.
</span><span class="inferred0"><a name="line159"></a> 159   #
</span><span class="inferred1"><a name="line160"></a> 160   # Sessions are stored by default in a browser cookie that's cryptographically signed, but unencrypted.
</span><span class="inferred0"><a name="line161"></a> 161   # This prevents the user from tampering with the session but also allows him to see its contents.
</span><span class="inferred1"><a name="line162"></a> 162   #
</span><span class="inferred0"><a name="line163"></a> 163   # Do not put secret information in cookie-based sessions!
</span><span class="inferred1"><a name="line164"></a> 164   #
</span><span class="inferred0"><a name="line165"></a> 165   # Other options for session storage are:
</span><span class="inferred1"><a name="line166"></a> 166   #
</span><span class="inferred0"><a name="line167"></a> 167   # * ActiveRecord::SessionStore - Sessions are stored in your database, which works better than PStore with multiple app servers and,
</span><span class="inferred1"><a name="line168"></a> 168   #   unlike CookieStore, hides your session contents from the user. To use ActiveRecord::SessionStore, set
</span><span class="inferred0"><a name="line169"></a> 169   #
</span><span class="inferred1"><a name="line170"></a> 170   #     config.action_controller.session_store = :active_record_store
</span><span class="inferred0"><a name="line171"></a> 171   #
</span><span class="inferred1"><a name="line172"></a> 172   #   in your &lt;tt&gt;config/environment.rb&lt;/tt&gt; and run &lt;tt&gt;rake db:sessions:create&lt;/tt&gt;.
</span><span class="inferred0"><a name="line173"></a> 173   #
</span><span class="inferred1"><a name="line174"></a> 174   # * MemCacheStore - Sessions are stored as entries in your memcached cache.
</span><span class="inferred0"><a name="line175"></a> 175   #   Set the session store type in &lt;tt&gt;config/environment.rb&lt;/tt&gt;:
</span><span class="inferred1"><a name="line176"></a> 176   #
</span><span class="inferred0"><a name="line177"></a> 177   #     config.action_controller.session_store = :mem_cache_store
</span><span class="inferred1"><a name="line178"></a> 178   #
</span><span class="inferred0"><a name="line179"></a> 179   #   This assumes that memcached has been installed and configured properly.
</span><span class="inferred1"><a name="line180"></a> 180   #   See the MemCacheStore docs for more information.
</span><span class="inferred0"><a name="line181"></a> 181   #
</span><span class="inferred1"><a name="line182"></a> 182   # == Responses
</span><span class="inferred0"><a name="line183"></a> 183   #
</span><span class="inferred1"><a name="line184"></a> 184   # Each action results in a response, which holds the headers and document to be sent to the user's browser. The actual response
</span><span class="inferred0"><a name="line185"></a> 185   # object is generated automatically through the use of renders and redirects and requires no user intervention.
</span><span class="inferred1"><a name="line186"></a> 186   #
</span><span class="inferred0"><a name="line187"></a> 187   # == Renders
</span><span class="inferred1"><a name="line188"></a> 188   #
</span><span class="inferred0"><a name="line189"></a> 189   # Action Controller sends content to the user by using one of five rendering methods. The most versatile and common is the rendering
</span><span class="inferred1"><a name="line190"></a> 190   # of a template. Included in the Action Pack is the Action View, which enables rendering of ERb templates. It's automatically configured.
</span><span class="inferred0"><a name="line191"></a> 191   # The controller passes objects to the view by assigning instance variables:
</span><span class="inferred1"><a name="line192"></a> 192   #
</span><span class="inferred0"><a name="line193"></a> 193   #   def show
</span><span class="inferred1"><a name="line194"></a> 194   #     @post = Post.find(params[:id])
</span><span class="inferred0"><a name="line195"></a> 195   #   end
</span><span class="inferred1"><a name="line196"></a> 196   #
</span><span class="inferred0"><a name="line197"></a> 197   # Which are then automatically available to the view:
</span><span class="inferred1"><a name="line198"></a> 198   #
</span><span class="inferred0"><a name="line199"></a> 199   #   Title: &lt;%= @post.title %&gt;
</span><span class="inferred1"><a name="line200"></a> 200   #
</span><span class="inferred0"><a name="line201"></a> 201   # You don't have to rely on the automated rendering. Especially actions that could result in the rendering of different templates will use
</span><span class="inferred1"><a name="line202"></a> 202   # the manual rendering methods:
</span><span class="inferred0"><a name="line203"></a> 203   #
</span><span class="inferred1"><a name="line204"></a> 204   #   def search
</span><span class="inferred0"><a name="line205"></a> 205   #     @results = Search.find(params[:query])
</span><span class="inferred1"><a name="line206"></a> 206   #     case @results
</span><span class="inferred0"><a name="line207"></a> 207   #       when 0 then render :action =&gt; &quot;no_results&quot;
</span><span class="inferred1"><a name="line208"></a> 208   #       when 1 then render :action =&gt; &quot;show&quot;
</span><span class="inferred0"><a name="line209"></a> 209   #       when 2..10 then render :action =&gt; &quot;show_many&quot;
</span><span class="inferred1"><a name="line210"></a> 210   #     end
</span><span class="inferred0"><a name="line211"></a> 211   #   end
</span><span class="inferred1"><a name="line212"></a> 212   #
</span><span class="inferred0"><a name="line213"></a> 213   # Read more about writing ERb and Builder templates in link:classes/ActionView/Base.html.
</span><span class="inferred1"><a name="line214"></a> 214   #
</span><span class="inferred0"><a name="line215"></a> 215   # == Redirects
</span><span class="inferred1"><a name="line216"></a> 216   #
</span><span class="inferred0"><a name="line217"></a> 217   # Redirects are used to move from one action to another. For example, after a &lt;tt&gt;create&lt;/tt&gt; action, which stores a blog entry to a database,
</span><span class="inferred1"><a name="line218"></a> 218   # we might like to show the user the new entry. Because we're following good DRY principles (Don't Repeat Yourself), we're going to reuse (and redirect to)
</span><span class="inferred0"><a name="line219"></a> 219   # a &lt;tt&gt;show&lt;/tt&gt; action that we'll assume has already been created. The code might look like this:
</span><span class="inferred1"><a name="line220"></a> 220   #
</span><span class="inferred0"><a name="line221"></a> 221   #   def create
</span><span class="inferred1"><a name="line222"></a> 222   #     @entry = Entry.new(params[:entry])
</span><span class="inferred0"><a name="line223"></a> 223   #     if @entry.save
</span><span class="inferred1"><a name="line224"></a> 224   #       # The entry was saved correctly, redirect to show
</span><span class="inferred0"><a name="line225"></a> 225   #       redirect_to :action =&gt; 'show', :id =&gt; @entry.id
</span><span class="inferred1"><a name="line226"></a> 226   #     else
</span><span class="inferred0"><a name="line227"></a> 227   #       # things didn't go so well, do something else
</span><span class="inferred1"><a name="line228"></a> 228   #     end
</span><span class="inferred0"><a name="line229"></a> 229   #   end
</span><span class="inferred1"><a name="line230"></a> 230   #
</span><span class="inferred0"><a name="line231"></a> 231   # In this case, after saving our new entry to the database, the user is redirected to the &lt;tt&gt;show&lt;/tt&gt; method which is then executed.
</span><span class="inferred1"><a name="line232"></a> 232   #
</span><span class="inferred0"><a name="line233"></a> 233   # == Calling multiple redirects or renders
</span><span class="inferred1"><a name="line234"></a> 234   #
</span><span class="inferred0"><a name="line235"></a> 235   # An action may contain only a single render or a single redirect. Attempting to try to do either again will result in a DoubleRenderError:
</span><span class="inferred1"><a name="line236"></a> 236   #
</span><span class="inferred0"><a name="line237"></a> 237   #   def do_something
</span><span class="inferred1"><a name="line238"></a> 238   #     redirect_to :action =&gt; &quot;elsewhere&quot;
</span><span class="inferred0"><a name="line239"></a> 239   #     render :action =&gt; &quot;overthere&quot; # raises DoubleRenderError
</span><span class="inferred1"><a name="line240"></a> 240   #   end
</span><span class="inferred0"><a name="line241"></a> 241   #
</span><span class="inferred1"><a name="line242"></a> 242   # If you need to redirect on the condition of something, then be sure to add &quot;and return&quot; to halt execution.
</span><span class="inferred0"><a name="line243"></a> 243   #
</span><span class="inferred1"><a name="line244"></a> 244   #   def do_something
</span><span class="inferred0"><a name="line245"></a> 245   #     redirect_to(:action =&gt; &quot;elsewhere&quot;) and return if monkeys.nil?
</span><span class="inferred1"><a name="line246"></a> 246   #     render :action =&gt; &quot;overthere&quot; # won't be called if monkeys is nil
</span><span class="inferred0"><a name="line247"></a> 247   #   end
</span><span class="inferred1"><a name="line248"></a> 248   #
</span><span class="marked0"><a name="line249"></a> 249   class Base
</span><span class="marked1"><a name="line250"></a> 250     DEFAULT_RENDER_STATUS_CODE = &quot;200 OK&quot;
</span><span class="inferred0"><a name="line251"></a> 251 
</span><span class="marked1"><a name="line252"></a> 252     include StatusCodes
</span><span class="inferred0"><a name="line253"></a> 253 
</span><span class="marked1"><a name="line254"></a> 254     cattr_reader :protected_instance_variables
</span><span class="inferred0"><a name="line255"></a> 255     # Controller specific instance variables which will not be accessible inside views.
</span><span class="marked1"><a name="line256"></a> 256     @@protected_instance_variables = %w(@assigns @performed_redirect @performed_render @variables_added @request_origin @url @parent_controller
</span><span class="inferred0"><a name="line257"></a> 257                                         @action_name @before_filter_chain_aborted @action_cache_path @_session @_headers @_params
</span><span class="inferred1"><a name="line258"></a> 258                                         @_flash @_response)
</span><span class="inferred0"><a name="line259"></a> 259 
</span><span class="inferred1"><a name="line260"></a> 260     # Prepends all the URL-generating helpers from AssetHelper. This makes it possible to easily move javascripts, stylesheets,
</span><span class="inferred0"><a name="line261"></a> 261     # and images to a dedicated asset server away from the main web server. Example:
</span><span class="inferred1"><a name="line262"></a> 262     #   ActionController::Base.asset_host = &quot;http://assets.example.com&quot;
</span><span class="marked0"><a name="line263"></a> 263     @@asset_host = &quot;&quot;
</span><span class="marked1"><a name="line264"></a> 264     cattr_accessor :asset_host
</span><span class="inferred0"><a name="line265"></a> 265 
</span><span class="inferred1"><a name="line266"></a> 266     # All requests are considered local by default, so everyone will be exposed to detailed debugging screens on errors.
</span><span class="inferred0"><a name="line267"></a> 267     # When the application is ready to go public, this should be set to false, and the protected method &lt;tt&gt;local_request?&lt;/tt&gt;
</span><span class="inferred1"><a name="line268"></a> 268     # should instead be implemented in the controller to determine when debugging screens should be shown.
</span><span class="marked0"><a name="line269"></a> 269     @@consider_all_requests_local = true
</span><span class="marked1"><a name="line270"></a> 270     cattr_accessor :consider_all_requests_local
</span><span class="inferred0"><a name="line271"></a> 271 
</span><span class="inferred1"><a name="line272"></a> 272     # Indicates whether to allow concurrent action processing. Your
</span><span class="inferred0"><a name="line273"></a> 273     # controller actions and any other code they call must also behave well
</span><span class="inferred1"><a name="line274"></a> 274     # when called from concurrent threads. Turned off by default.
</span><span class="marked0"><a name="line275"></a> 275     @@allow_concurrency = false
</span><span class="marked1"><a name="line276"></a> 276     cattr_accessor :allow_concurrency
</span><span class="inferred0"><a name="line277"></a> 277 
</span><span class="inferred1"><a name="line278"></a> 278     # Modern REST web services often need to submit complex data to the web application.
</span><span class="inferred0"><a name="line279"></a> 279     # The &lt;tt&gt;@@param_parsers&lt;/tt&gt; hash lets you register handlers which will process the HTTP body and add parameters to the
</span><span class="inferred1"><a name="line280"></a> 280     # &lt;tt&gt;params&lt;/tt&gt; hash. These handlers are invoked for POST and PUT requests.
</span><span class="inferred0"><a name="line281"></a> 281     #
</span><span class="inferred1"><a name="line282"></a> 282     # By default &lt;tt&gt;application/xml&lt;/tt&gt; is enabled. A XmlSimple class with the same param name as the root will be instantiated
</span><span class="inferred0"><a name="line283"></a> 283     # in the &lt;tt&gt;params&lt;/tt&gt;. This allows XML requests to mask themselves as regular form submissions, so you can have one
</span><span class="inferred1"><a name="line284"></a> 284     # action serve both regular forms and web service requests.
</span><span class="inferred0"><a name="line285"></a> 285     #
</span><span class="inferred1"><a name="line286"></a> 286     # Example of doing your own parser for a custom content type:
</span><span class="inferred0"><a name="line287"></a> 287     #
</span><span class="inferred1"><a name="line288"></a> 288     #   ActionController::Base.param_parsers[Mime::Type.lookup('application/atom+xml')] = Proc.new do |data|
</span><span class="inferred0"><a name="line289"></a> 289     #      node = REXML::Document.new(post)
</span><span class="inferred1"><a name="line290"></a> 290     #     { node.root.name =&gt; node.root }
</span><span class="inferred0"><a name="line291"></a> 291     #   end
</span><span class="inferred1"><a name="line292"></a> 292     #
</span><span class="inferred0"><a name="line293"></a> 293     # Note: Up until release 1.1 of Rails, Action Controller would default to using XmlSimple configured to discard the
</span><span class="inferred1"><a name="line294"></a> 294     # root node for such requests. The new default is to keep the root, such that &quot;&lt;r&gt;&lt;name&gt;David&lt;/name&gt;&lt;/r&gt;&quot; results
</span><span class="inferred0"><a name="line295"></a> 295     # in &lt;tt&gt;params[:r][:name]&lt;/tt&gt; for &quot;David&quot; instead of &lt;tt&gt;params[:name]&lt;/tt&gt;. To get the old behavior, you can
</span><span class="inferred1"><a name="line296"></a> 296     # re-register XmlSimple as application/xml handler ike this:
</span><span class="inferred0"><a name="line297"></a> 297     #
</span><span class="inferred1"><a name="line298"></a> 298     #   ActionController::Base.param_parsers[Mime::XML] =
</span><span class="inferred0"><a name="line299"></a> 299     #     Proc.new { |data| XmlSimple.xml_in(data, 'ForceArray' =&gt; false) }
</span><span class="inferred1"><a name="line300"></a> 300     #
</span><span class="inferred0"><a name="line301"></a> 301     # A YAML parser is also available and can be turned on with:
</span><span class="inferred1"><a name="line302"></a> 302     #
</span><span class="inferred0"><a name="line303"></a> 303     #   ActionController::Base.param_parsers[Mime::YAML] = :yaml
</span><span class="marked1"><a name="line304"></a> 304     @@param_parsers = {}
</span><span class="marked0"><a name="line305"></a> 305     cattr_accessor :param_parsers
</span><span class="inferred1"><a name="line306"></a> 306 
</span><span class="inferred0"><a name="line307"></a> 307     # Controls the default charset for all renders.
</span><span class="marked1"><a name="line308"></a> 308     @@default_charset = &quot;utf-8&quot;
</span><span class="marked0"><a name="line309"></a> 309     cattr_accessor :default_charset
</span><span class="inferred1"><a name="line310"></a> 310 
</span><span class="inferred0"><a name="line311"></a> 311     # The logger is used for generating information on the action run-time (including benchmarking) if available.
</span><span class="inferred1"><a name="line312"></a> 312     # Can be set to nil for no logging. Compatible with both Ruby's own Logger and Log4r loggers.
</span><span class="marked0"><a name="line313"></a> 313     cattr_accessor :logger
</span><span class="inferred1"><a name="line314"></a> 314 
</span><span class="inferred0"><a name="line315"></a> 315     # Controls the resource action separator
</span><span class="marked1"><a name="line316"></a> 316     @@resource_action_separator = &quot;/&quot;
</span><span class="marked0"><a name="line317"></a> 317     cattr_accessor :resource_action_separator
</span><span class="inferred1"><a name="line318"></a> 318 
</span><span class="inferred0"><a name="line319"></a> 319     # Allow to override path names for default resources' actions
</span><span class="marked1"><a name="line320"></a> 320     @@resources_path_names = { :new =&gt; 'new', :edit =&gt; 'edit' }
</span><span class="marked0"><a name="line321"></a> 321     cattr_accessor :resources_path_names
</span><span class="inferred1"><a name="line322"></a> 322 
</span><span class="inferred0"><a name="line323"></a> 323     # Sets the token parameter name for RequestForgery. Calling +protect_from_forgery+
</span><span class="inferred1"><a name="line324"></a> 324     # sets it to &lt;tt&gt;:authenticity_token&lt;/tt&gt; by default.
</span><span class="marked0"><a name="line325"></a> 325     cattr_accessor :request_forgery_protection_token
</span><span class="inferred1"><a name="line326"></a> 326 
</span><span class="inferred0"><a name="line327"></a> 327     # Controls the IP Spoofing check when determining the remote IP.
</span><span class="marked1"><a name="line328"></a> 328     @@ip_spoofing_check = true
</span><span class="marked0"><a name="line329"></a> 329     cattr_accessor :ip_spoofing_check
</span><span class="inferred1"><a name="line330"></a> 330 
</span><span class="inferred0"><a name="line331"></a> 331     # Indicates whether or not optimise the generated named
</span><span class="inferred1"><a name="line332"></a> 332     # route helper methods
</span><span class="marked0"><a name="line333"></a> 333     cattr_accessor :optimise_named_routes
</span><span class="marked1"><a name="line334"></a> 334     self.optimise_named_routes = true
</span><span class="inferred0"><a name="line335"></a> 335 
</span><span class="inferred1"><a name="line336"></a> 336     # Indicates whether the response format should be determined by examining the Accept HTTP header,
</span><span class="inferred0"><a name="line337"></a> 337     # or by using the simpler params + ajax rules.
</span><span class="inferred1"><a name="line338"></a> 338     #
</span><span class="inferred0"><a name="line339"></a> 339     # If this is set to +true+ (the default) then +respond_to+ and +Request#format+ will take the Accept
</span><span class="inferred1"><a name="line340"></a> 340     # header into account.  If it is set to false then the request format will be determined solely
</span><span class="inferred0"><a name="line341"></a> 341     # by examining params[:format].  If params format is missing, the format will be either HTML or
</span><span class="inferred1"><a name="line342"></a> 342     # Javascript depending on whether the request is an AJAX request.
</span><span class="marked0"><a name="line343"></a> 343     cattr_accessor :use_accept_header
</span><span class="marked1"><a name="line344"></a> 344     self.use_accept_header = true
</span><span class="inferred0"><a name="line345"></a> 345 
</span><span class="inferred1"><a name="line346"></a> 346     # Controls whether request forgergy protection is turned on or not. Turned off by default only in test mode.
</span><span class="marked0"><a name="line347"></a> 347     class_inheritable_accessor :allow_forgery_protection
</span><span class="marked1"><a name="line348"></a> 348     self.allow_forgery_protection = true
</span><span class="inferred0"><a name="line349"></a> 349 
</span><span class="inferred1"><a name="line350"></a> 350     # If you are deploying to a subdirectory, you will need to set
</span><span class="inferred0"><a name="line351"></a> 351     # &lt;tt&gt;config.action_controller.relative_url_root&lt;/tt&gt;
</span><span class="inferred1"><a name="line352"></a> 352     # This defaults to ENV['RAILS_RELATIVE_URL_ROOT']
</span><span class="marked0"><a name="line353"></a> 353     cattr_accessor :relative_url_root
</span><span class="marked1"><a name="line354"></a> 354     self.relative_url_root = ENV['RAILS_RELATIVE_URL_ROOT']
</span><span class="inferred0"><a name="line355"></a> 355 
</span><span class="inferred1"><a name="line356"></a> 356     # Holds the request object that's primarily used to get environment variables through access like
</span><span class="inferred0"><a name="line357"></a> 357     # &lt;tt&gt;request.env[&quot;REQUEST_URI&quot;]&lt;/tt&gt;.
</span><span class="marked1"><a name="line358"></a> 358     attr_internal :request
</span><span class="inferred0"><a name="line359"></a> 359 
</span><span class="inferred1"><a name="line360"></a> 360     # Holds a hash of all the GET, POST, and Url parameters passed to the action. Accessed like &lt;tt&gt;params[&quot;post_id&quot;]&lt;/tt&gt;
</span><span class="inferred0"><a name="line361"></a> 361     # to get the post_id. No type casts are made, so all values are returned as strings.
</span><span class="marked1"><a name="line362"></a> 362     attr_internal :params
</span><span class="inferred0"><a name="line363"></a> 363 
</span><span class="inferred1"><a name="line364"></a> 364     # Holds the response object that's primarily used to set additional HTTP headers through access like
</span><span class="inferred0"><a name="line365"></a> 365     # &lt;tt&gt;response.headers[&quot;Cache-Control&quot;] = &quot;no-cache&quot;&lt;/tt&gt;. Can also be used to access the final body HTML after a template
</span><span class="inferred1"><a name="line366"></a> 366     # has been rendered through response.body -- useful for &lt;tt&gt;after_filter&lt;/tt&gt;s that wants to manipulate the output,
</span><span class="inferred0"><a name="line367"></a> 367     # such as a OutputCompressionFilter.
</span><span class="marked1"><a name="line368"></a> 368     attr_internal :response
</span><span class="inferred0"><a name="line369"></a> 369 
</span><span class="inferred1"><a name="line370"></a> 370     # Holds a hash of objects in the session. Accessed like &lt;tt&gt;session[:person]&lt;/tt&gt; to get the object tied to the &quot;person&quot;
</span><span class="inferred0"><a name="line371"></a> 371     # key. The session will hold any type of object as values, but the key should be a string or symbol.
</span><span class="marked1"><a name="line372"></a> 372     attr_internal :session
</span><span class="inferred0"><a name="line373"></a> 373 
</span><span class="inferred1"><a name="line374"></a> 374     # Holds a hash of header names and values. Accessed like &lt;tt&gt;headers[&quot;Cache-Control&quot;]&lt;/tt&gt; to get the value of the Cache-Control
</span><span class="inferred0"><a name="line375"></a> 375     # directive. Values should always be specified as strings.
</span><span class="marked1"><a name="line376"></a> 376     attr_internal :headers
</span><span class="inferred0"><a name="line377"></a> 377 
</span><span class="inferred1"><a name="line378"></a> 378     # Returns the name of the action this controller is processing.
</span><span class="marked0"><a name="line379"></a> 379     attr_accessor :action_name
</span><span class="inferred1"><a name="line380"></a> 380 
</span><span class="marked0"><a name="line381"></a> 381     class &lt;&lt; self
</span><span class="marked1"><a name="line382"></a> 382       def call(env)
</span><span class="uncovered0"><a name="line383"></a> 383         # HACK: For global rescue to have access to the original request and response
</span><span class="uncovered1"><a name="line384"></a> 384         request = env[&quot;action_controller.rescue.request&quot;] ||= Request.new(env)
</span><span class="uncovered0"><a name="line385"></a> 385         response = env[&quot;action_controller.rescue.response&quot;] ||= Response.new
</span><span class="uncovered1"><a name="line386"></a> 386         process(request, response)
</span><span class="uncovered0"><a name="line387"></a> 387       end
</span><span class="inferred1"><a name="line388"></a> 388 
</span><span class="inferred0"><a name="line389"></a> 389       # Factory for the standard create, process loop where the controller is discarded after processing.
</span><span class="marked1"><a name="line390"></a> 390       def process(request, response) #:nodoc:
</span><span class="uncovered0"><a name="line391"></a> 391         new.process(request, response)
</span><span class="uncovered1"><a name="line392"></a> 392       end
</span><span class="inferred0"><a name="line393"></a> 393 
</span><span class="inferred1"><a name="line394"></a> 394       # Converts the class name from something like &quot;OneModule::TwoModule::NeatController&quot; to &quot;NeatController&quot;.
</span><span class="marked0"><a name="line395"></a> 395       def controller_class_name
</span><span class="uncovered1"><a name="line396"></a> 396         @controller_class_name ||= name.demodulize
</span><span class="uncovered0"><a name="line397"></a> 397       end
</span><span class="inferred1"><a name="line398"></a> 398 
</span><span class="inferred0"><a name="line399"></a> 399       # Converts the class name from something like &quot;OneModule::TwoModule::NeatController&quot; to &quot;neat&quot;.
</span><span class="marked1"><a name="line400"></a> 400       def controller_name
</span><span class="uncovered0"><a name="line401"></a> 401         @controller_name ||= controller_class_name.sub(/Controller$/, '').underscore
</span><span class="uncovered1"><a name="line402"></a> 402       end
</span><span class="inferred0"><a name="line403"></a> 403 
</span><span class="inferred1"><a name="line404"></a> 404       # Converts the class name from something like &quot;OneModule::TwoModule::NeatController&quot; to &quot;one_module/two_module/neat&quot;.
</span><span class="marked0"><a name="line405"></a> 405       def controller_path
</span><span class="uncovered1"><a name="line406"></a> 406         @controller_path ||= name.gsub(/Controller$/, '').underscore
</span><span class="uncovered0"><a name="line407"></a> 407       end
</span><span class="inferred1"><a name="line408"></a> 408 
</span><span class="inferred0"><a name="line409"></a> 409       # Return an array containing the names of public methods that have been marked hidden from the action processor.
</span><span class="inferred1"><a name="line410"></a> 410       # By default, all methods defined in ActionController::Base and included modules are hidden.
</span><span class="inferred0"><a name="line411"></a> 411       # More methods can be hidden using &lt;tt&gt;hide_actions&lt;/tt&gt;.
</span><span class="marked1"><a name="line412"></a> 412       def hidden_actions
</span><span class="uncovered0"><a name="line413"></a> 413         read_inheritable_attribute(:hidden_actions) || write_inheritable_attribute(:hidden_actions, [])
</span><span class="uncovered1"><a name="line414"></a> 414       end
</span><span class="inferred0"><a name="line415"></a> 415 
</span><span class="inferred1"><a name="line416"></a> 416       # Hide each of the given methods from being callable as actions.
</span><span class="marked0"><a name="line417"></a> 417       def hide_action(*names)
</span><span class="uncovered1"><a name="line418"></a> 418         write_inheritable_attribute(:hidden_actions, hidden_actions | names.map { |name| name.to_s })
</span><span class="uncovered0"><a name="line419"></a> 419       end
</span><span class="inferred1"><a name="line420"></a> 420 
</span><span class="inferred0"><a name="line421"></a> 421       # View load paths determine the bases from which template references can be made. So a call to
</span><span class="inferred1"><a name="line422"></a> 422       # render(&quot;test/template&quot;) will be looked up in the view load paths array and the closest match will be
</span><span class="inferred0"><a name="line423"></a> 423       # returned.
</span><span class="marked1"><a name="line424"></a> 424       def view_paths
</span><span class="marked0"><a name="line425"></a> 425         if defined? @view_paths
</span><span class="marked1"><a name="line426"></a> 426           @view_paths
</span><span class="inferred0"><a name="line427"></a> 427         else
</span><span class="marked1"><a name="line428"></a> 428           superclass.view_paths
</span><span class="inferred0"><a name="line429"></a> 429         end
</span><span class="marked1"><a name="line430"></a> 430       end
</span><span class="inferred0"><a name="line431"></a> 431 
</span><span class="marked1"><a name="line432"></a> 432       def view_paths=(value)
</span><span class="marked0"><a name="line433"></a> 433         @view_paths = ActionView::Base.process_view_paths(value) if value
</span><span class="marked1"><a name="line434"></a> 434       end
</span><span class="inferred0"><a name="line435"></a> 435 
</span><span class="inferred1"><a name="line436"></a> 436       # Adds a view_path to the front of the view_paths array.
</span><span class="inferred0"><a name="line437"></a> 437       # If the current class has no view paths, copy them from
</span><span class="inferred1"><a name="line438"></a> 438       # the superclass.  This change will be visible for all future requests.
</span><span class="inferred0"><a name="line439"></a> 439       #
</span><span class="inferred1"><a name="line440"></a> 440       #   ArticleController.prepend_view_path(&quot;views/default&quot;)
</span><span class="inferred0"><a name="line441"></a> 441       #   ArticleController.prepend_view_path([&quot;views/default&quot;, &quot;views/custom&quot;])
</span><span class="inferred1"><a name="line442"></a> 442       #
</span><span class="marked0"><a name="line443"></a> 443       def prepend_view_path(path)
</span><span class="uncovered1"><a name="line444"></a> 444         @view_paths = superclass.view_paths.dup if !defined?(@view_paths) || @view_paths.nil?
</span><span class="uncovered0"><a name="line445"></a> 445         @view_paths.unshift(*path)
</span><span class="uncovered1"><a name="line446"></a> 446       end
</span><span class="inferred0"><a name="line447"></a> 447 
</span><span class="inferred1"><a name="line448"></a> 448       # Adds a view_path to the end of the view_paths array.
</span><span class="inferred0"><a name="line449"></a> 449       # If the current class has no view paths, copy them from
</span><span class="inferred1"><a name="line450"></a> 450       # the superclass. This change will be visible for all future requests.
</span><span class="inferred0"><a name="line451"></a> 451       #
</span><span class="inferred1"><a name="line452"></a> 452       #   ArticleController.append_view_path(&quot;views/default&quot;)
</span><span class="inferred0"><a name="line453"></a> 453       #   ArticleController.append_view_path([&quot;views/default&quot;, &quot;views/custom&quot;])
</span><span class="inferred1"><a name="line454"></a> 454       #
</span><span class="marked0"><a name="line455"></a> 455       def append_view_path(path)
</span><span class="uncovered1"><a name="line456"></a> 456         @view_paths = superclass.view_paths.dup if @view_paths.nil?
</span><span class="uncovered0"><a name="line457"></a> 457         @view_paths.push(*path)
</span><span class="uncovered1"><a name="line458"></a> 458       end
</span><span class="inferred0"><a name="line459"></a> 459 
</span><span class="inferred1"><a name="line460"></a> 460       # Replace sensitive parameter data from the request log.
</span><span class="inferred0"><a name="line461"></a> 461       # Filters parameters that have any of the arguments as a substring.
</span><span class="inferred1"><a name="line462"></a> 462       # Looks in all subhashes of the param hash for keys to filter.
</span><span class="inferred0"><a name="line463"></a> 463       # If a block is given, each key and value of the parameter hash and all
</span><span class="inferred1"><a name="line464"></a> 464       # subhashes is passed to it, the value or key
</span><span class="inferred0"><a name="line465"></a> 465       # can be replaced using String#replace or similar method.
</span><span class="inferred1"><a name="line466"></a> 466       #
</span><span class="inferred0"><a name="line467"></a> 467       # Examples:
</span><span class="inferred1"><a name="line468"></a> 468       #   filter_parameter_logging
</span><span class="inferred0"><a name="line469"></a> 469       #   =&gt; Does nothing, just slows the logging process down
</span><span class="inferred1"><a name="line470"></a> 470       #
</span><span class="inferred0"><a name="line471"></a> 471       #   filter_parameter_logging :password
</span><span class="inferred1"><a name="line472"></a> 472       #   =&gt; replaces the value to all keys matching /password/i with &quot;[FILTERED]&quot;
</span><span class="inferred0"><a name="line473"></a> 473       #
</span><span class="inferred1"><a name="line474"></a> 474       #   filter_parameter_logging :foo, &quot;bar&quot;
</span><span class="inferred0"><a name="line475"></a> 475       #   =&gt; replaces the value to all keys matching /foo|bar/i with &quot;[FILTERED]&quot;
</span><span class="inferred1"><a name="line476"></a> 476       #
</span><span class="inferred0"><a name="line477"></a> 477       #   filter_parameter_logging { |k,v| v.reverse! if k =~ /secret/i }
</span><span class="inferred1"><a name="line478"></a> 478       #   =&gt; reverses the value to all keys matching /secret/i
</span><span class="inferred0"><a name="line479"></a> 479       #
</span><span class="inferred1"><a name="line480"></a> 480       #   filter_parameter_logging(:foo, &quot;bar&quot;) { |k,v| v.reverse! if k =~ /secret/i }
</span><span class="inferred0"><a name="line481"></a> 481       #   =&gt; reverses the value to all keys matching /secret/i, and
</span><span class="inferred1"><a name="line482"></a> 482       #      replaces the value to all keys matching /foo|bar/i with &quot;[FILTERED]&quot;
</span><span class="marked0"><a name="line483"></a> 483       def filter_parameter_logging(*filter_words, &amp;block)
</span><span class="uncovered1"><a name="line484"></a> 484         parameter_filter = Regexp.new(filter_words.collect{ |s| s.to_s }.join('|'), true) if filter_words.length &gt; 0
</span><span class="uncovered0"><a name="line485"></a> 485 
</span><span class="uncovered1"><a name="line486"></a> 486         define_method(:filter_parameters) do |unfiltered_parameters|
</span><span class="uncovered0"><a name="line487"></a> 487           filtered_parameters = {}
</span><span class="uncovered1"><a name="line488"></a> 488 
</span><span class="uncovered0"><a name="line489"></a> 489           unfiltered_parameters.each do |key, value|
</span><span class="uncovered1"><a name="line490"></a> 490             if key =~ parameter_filter
</span><span class="uncovered0"><a name="line491"></a> 491               filtered_parameters[key] = '[FILTERED]'
</span><span class="uncovered1"><a name="line492"></a> 492             elsif value.is_a?(Hash)
</span><span class="uncovered0"><a name="line493"></a> 493               filtered_parameters[key] = filter_parameters(value)
</span><span class="uncovered1"><a name="line494"></a> 494             elsif block_given?
</span><span class="uncovered0"><a name="line495"></a> 495               key = key.dup
</span><span class="uncovered1"><a name="line496"></a> 496               value = value.dup if value
</span><span class="uncovered0"><a name="line497"></a> 497               yield key, value
</span><span class="uncovered1"><a name="line498"></a> 498               filtered_parameters[key] = value
</span><span class="uncovered0"><a name="line499"></a> 499             else
</span><span class="uncovered1"><a name="line500"></a> 500               filtered_parameters[key] = value
</span><span class="uncovered0"><a name="line501"></a> 501             end
</span><span class="uncovered1"><a name="line502"></a> 502           end
</span><span class="uncovered0"><a name="line503"></a> 503 
</span><span class="uncovered1"><a name="line504"></a> 504           filtered_parameters
</span><span class="uncovered0"><a name="line505"></a> 505         end
</span><span class="uncovered1"><a name="line506"></a> 506         protected :filter_parameters
</span><span class="uncovered0"><a name="line507"></a> 507       end
</span><span class="inferred1"><a name="line508"></a> 508 
</span><span class="marked0"><a name="line509"></a> 509       delegate :exempt_from_layout, :to =&gt; 'ActionView::Template'
</span><span class="inferred1"><a name="line510"></a> 510     end
</span><span class="inferred0"><a name="line511"></a> 511 
</span><span class="marked1"><a name="line512"></a> 512     public
</span><span class="inferred0"><a name="line513"></a> 513       # Extracts the action_name from the request parameters and performs that action.
</span><span class="marked1"><a name="line514"></a> 514       def process(request, response, method = :perform_action, *arguments) #:nodoc:
</span><span class="uncovered0"><a name="line515"></a> 515         response.request = request
</span><span class="uncovered1"><a name="line516"></a> 516 
</span><span class="uncovered0"><a name="line517"></a> 517         initialize_template_class(response)
</span><span class="uncovered1"><a name="line518"></a> 518         assign_shortcuts(request, response)
</span><span class="uncovered0"><a name="line519"></a> 519         initialize_current_url
</span><span class="uncovered1"><a name="line520"></a> 520         assign_names
</span><span class="uncovered0"><a name="line521"></a> 521 
</span><span class="uncovered1"><a name="line522"></a> 522         log_processing
</span><span class="uncovered0"><a name="line523"></a> 523         send(method, *arguments)
</span><span class="uncovered1"><a name="line524"></a> 524 
</span><span class="uncovered0"><a name="line525"></a> 525         send_response
</span><span class="uncovered1"><a name="line526"></a> 526       ensure
</span><span class="uncovered0"><a name="line527"></a> 527         process_cleanup
</span><span class="uncovered1"><a name="line528"></a> 528       end
</span><span class="inferred0"><a name="line529"></a> 529 
</span><span class="marked1"><a name="line530"></a> 530       def send_response
</span><span class="uncovered0"><a name="line531"></a> 531         response.prepare!
</span><span class="uncovered1"><a name="line532"></a> 532         response
</span><span class="uncovered0"><a name="line533"></a> 533       end
</span><span class="inferred1"><a name="line534"></a> 534 
</span><span class="inferred0"><a name="line535"></a> 535       # Returns a URL that has been rewritten according to the options hash and the defined routes.
</span><span class="inferred1"><a name="line536"></a> 536       # (For doing a complete redirect, use +redirect_to+).
</span><span class="inferred0"><a name="line537"></a> 537       #
</span><span class="inferred1"><a name="line538"></a> 538       # &lt;tt&gt;url_for&lt;/tt&gt; is used to:
</span><span class="inferred0"><a name="line539"></a> 539       #
</span><span class="inferred1"><a name="line540"></a> 540       # All keys given to +url_for+ are forwarded to the Route module, save for the following:
</span><span class="inferred0"><a name="line541"></a> 541       # * &lt;tt&gt;:anchor&lt;/tt&gt; - Specifies the anchor name to be appended to the path. For example,
</span><span class="inferred1"><a name="line542"></a> 542       #   &lt;tt&gt;url_for :controller =&gt; 'posts', :action =&gt; 'show', :id =&gt; 10, :anchor =&gt; 'comments'&lt;/tt&gt;
</span><span class="inferred0"><a name="line543"></a> 543       #   will produce &quot;/posts/show/10#comments&quot;.
</span><span class="inferred1"><a name="line544"></a> 544       # * &lt;tt&gt;:only_path&lt;/tt&gt; - If true, returns the relative URL (omitting the protocol, host name, and port) (&lt;tt&gt;false&lt;/tt&gt; by default).
</span><span class="inferred0"><a name="line545"></a> 545       # * &lt;tt&gt;:trailing_slash&lt;/tt&gt; - If true, adds a trailing slash, as in &quot;/archive/2005/&quot;. Note that this
</span><span class="inferred1"><a name="line546"></a> 546       #   is currently not recommended since it breaks caching.
</span><span class="inferred0"><a name="line547"></a> 547       # * &lt;tt&gt;:host&lt;/tt&gt; - Overrides the default (current) host if provided.
</span><span class="inferred1"><a name="line548"></a> 548       # * &lt;tt&gt;:protocol&lt;/tt&gt; - Overrides the default (current) protocol if provided.
</span><span class="inferred0"><a name="line549"></a> 549       # * &lt;tt&gt;:port&lt;/tt&gt; - Optionally specify the port to connect to.
</span><span class="inferred1"><a name="line550"></a> 550       # * &lt;tt&gt;:user&lt;/tt&gt; - Inline HTTP authentication (only plucked out if &lt;tt&gt;:password&lt;/tt&gt; is also present).
</span><span class="inferred0"><a name="line551"></a> 551       # * &lt;tt&gt;:password&lt;/tt&gt; - Inline HTTP authentication (only plucked out if &lt;tt&gt;:user&lt;/tt&gt; is also present).
</span><span class="inferred1"><a name="line552"></a> 552       # * &lt;tt&gt;:skip_relative_url_root&lt;/tt&gt; - If true, the url is not constructed using the +relative_url_root+
</span><span class="inferred0"><a name="line553"></a> 553       #   of the request so the path will include the web server relative installation directory.
</span><span class="inferred1"><a name="line554"></a> 554       #
</span><span class="inferred0"><a name="line555"></a> 555       # The URL is generated from the remaining keys in the hash. A URL contains two key parts: the &lt;base&gt; and a query string.
</span><span class="inferred1"><a name="line556"></a> 556       # Routes composes a query string as the key/value pairs not included in the &lt;base&gt;.
</span><span class="inferred0"><a name="line557"></a> 557       #
</span><span class="inferred1"><a name="line558"></a> 558       # The default Routes setup supports a typical Rails path of &quot;controller/action/id&quot; where action and id are optional, with
</span><span class="inferred0"><a name="line559"></a> 559       # action defaulting to 'index' when not given. Here are some typical url_for statements and their corresponding URLs:
</span><span class="inferred1"><a name="line560"></a> 560       #
</span><span class="inferred0"><a name="line561"></a> 561       #   url_for :controller =&gt; 'posts', :action =&gt; 'recent'                # =&gt; 'proto://host.com/posts/recent'
</span><span class="inferred1"><a name="line562"></a> 562       #   url_for :controller =&gt; 'posts', :action =&gt; 'index'                 # =&gt; 'proto://host.com/posts'
</span><span class="inferred0"><a name="line563"></a> 563       #   url_for :controller =&gt; 'posts', :action =&gt; 'index', :port=&gt;'8033'  # =&gt; 'proto://host.com:8033/posts'
</span><span class="inferred1"><a name="line564"></a> 564       #   url_for :controller =&gt; 'posts', :action =&gt; 'show', :id =&gt; 10       # =&gt; 'proto://host.com/posts/show/10'
</span><span class="inferred0"><a name="line565"></a> 565       #   url_for :controller =&gt; 'posts', :user =&gt; 'd', :password =&gt; '123'   # =&gt; 'proto://d:123@host.com/posts'
</span><span class="inferred1"><a name="line566"></a> 566       #
</span><span class="inferred0"><a name="line567"></a> 567       # When generating a new URL, missing values may be filled in from the current request's parameters. For example,
</span><span class="inferred1"><a name="line568"></a> 568       # &lt;tt&gt;url_for :action =&gt; 'some_action'&lt;/tt&gt; will retain the current controller, as expected. This behavior extends to
</span><span class="inferred0"><a name="line569"></a> 569       # other parameters, including &lt;tt&gt;:controller&lt;/tt&gt;, &lt;tt&gt;:id&lt;/tt&gt;, and any other parameters that are placed into a Route's
</span><span class="inferred1"><a name="line570"></a> 570       # path.
</span><span class="inferred0"><a name="line571"></a> 571       #  
</span><span class="inferred1"><a name="line572"></a> 572       # The URL helpers such as &lt;tt&gt;url_for&lt;/tt&gt; have a limited form of memory: when generating a new URL, they can look for
</span><span class="inferred0"><a name="line573"></a> 573       # missing values in the current request's parameters. Routes attempts to guess when a value should and should not be
</span><span class="inferred1"><a name="line574"></a> 574       # taken from the defaults. There are a few simple rules on how this is performed:
</span><span class="inferred0"><a name="line575"></a> 575       #
</span><span class="inferred1"><a name="line576"></a> 576       # * If the controller name begins with a slash no defaults are used:
</span><span class="inferred0"><a name="line577"></a> 577       #
</span><span class="inferred1"><a name="line578"></a> 578       #     url_for :controller =&gt; '/home'
</span><span class="inferred0"><a name="line579"></a> 579       #
</span><span class="inferred1"><a name="line580"></a> 580       #   In particular, a leading slash ensures no namespace is assumed. Thus,
</span><span class="inferred0"><a name="line581"></a> 581       #   while &lt;tt&gt;url_for :controller =&gt; 'users'&lt;/tt&gt; may resolve to
</span><span class="inferred1"><a name="line582"></a> 582       #   &lt;tt&gt;Admin::UsersController&lt;/tt&gt; if the current controller lives under
</span><span class="inferred0"><a name="line583"></a> 583       #   that module, &lt;tt&gt;url_for :controller =&gt; '/users'&lt;/tt&gt; ensures you link
</span><span class="inferred1"><a name="line584"></a> 584       #   to &lt;tt&gt;::UsersController&lt;/tt&gt; no matter what.
</span><span class="inferred0"><a name="line585"></a> 585       # * If the controller changes, the action will default to index unless provided
</span><span class="inferred1"><a name="line586"></a> 586       #
</span><span class="inferred0"><a name="line587"></a> 587       # The final rule is applied while the URL is being generated and is best illustrated by an example. Let us consider the
</span><span class="inferred1"><a name="line588"></a> 588       # route given by &lt;tt&gt;map.connect 'people/:last/:first/:action', :action =&gt; 'bio', :controller =&gt; 'people'&lt;/tt&gt;.
</span><span class="inferred0"><a name="line589"></a> 589       #
</span><span class="inferred1"><a name="line590"></a> 590       # Suppose that the current URL is &quot;people/hh/david/contacts&quot;. Let's consider a few different cases of URLs which are generated
</span><span class="inferred0"><a name="line591"></a> 591       # from this page.
</span><span class="inferred1"><a name="line592"></a> 592       #
</span><span class="inferred0"><a name="line593"></a> 593       # * &lt;tt&gt;url_for :action =&gt; 'bio'&lt;/tt&gt; -- During the generation of this URL, default values will be used for the first and
</span><span class="inferred1"><a name="line594"></a> 594       # last components, and the action shall change. The generated URL will be, &quot;people/hh/david/bio&quot;.
</span><span class="inferred0"><a name="line595"></a> 595       # * &lt;tt&gt;url_for :first =&gt; 'davids-little-brother'&lt;/tt&gt; This generates the URL 'people/hh/davids-little-brother' -- note
</span><span class="inferred1"><a name="line596"></a> 596       #   that this URL leaves out the assumed action of 'bio'.
</span><span class="inferred0"><a name="line597"></a> 597       #
</span><span class="inferred1"><a name="line598"></a> 598       # However, you might ask why the action from the current request, 'contacts', isn't carried over into the new URL. The
</span><span class="inferred0"><a name="line599"></a> 599       # answer has to do with the order in which the parameters appear in the generated path. In a nutshell, since the
</span><span class="inferred1"><a name="line600"></a> 600       # value that appears in the slot for &lt;tt&gt;:first&lt;/tt&gt; is not equal to default value for &lt;tt&gt;:first&lt;/tt&gt; we stop using
</span><span class="inferred0"><a name="line601"></a> 601       # defaults. On its own, this rule can account for much of the typical Rails URL behavior.
</span><span class="inferred1"><a name="line602"></a> 602       #  
</span><span class="inferred0"><a name="line603"></a> 603       # Although a convenience, defaults can occasionally get in your way. In some cases a default persists longer than desired.
</span><span class="inferred1"><a name="line604"></a> 604       # The default may be cleared by adding &lt;tt&gt;:name =&gt; nil&lt;/tt&gt; to &lt;tt&gt;url_for&lt;/tt&gt;'s options.
</span><span class="inferred0"><a name="line605"></a> 605       # This is often required when writing form helpers, since the defaults in play may vary greatly depending upon where the
</span><span class="inferred1"><a name="line606"></a> 606       # helper is used from. The following line will redirect to PostController's default action, regardless of the page it is
</span><span class="inferred0"><a name="line607"></a> 607       # displayed on:
</span><span class="inferred1"><a name="line608"></a> 608       #
</span><span class="inferred0"><a name="line609"></a> 609       #   url_for :controller =&gt; 'posts', :action =&gt; nil
</span><span class="inferred1"><a name="line610"></a> 610       #
</span><span class="inferred0"><a name="line611"></a> 611       # If you explicitly want to create a URL that's almost the same as the current URL, you can do so using the
</span><span class="inferred1"><a name="line612"></a> 612       # &lt;tt&gt;:overwrite_params&lt;/tt&gt; options. Say for your posts you have different views for showing and printing them.
</span><span class="inferred0"><a name="line613"></a> 613       # Then, in the show view, you get the URL for the print view like this
</span><span class="inferred1"><a name="line614"></a> 614       #
</span><span class="inferred0"><a name="line615"></a> 615       #   url_for :overwrite_params =&gt; { :action =&gt; 'print' }
</span><span class="inferred1"><a name="line616"></a> 616       #
</span><span class="inferred0"><a name="line617"></a> 617       # This takes the current URL as is and only exchanges the action. In contrast, &lt;tt&gt;url_for :action =&gt; 'print'&lt;/tt&gt;
</span><span class="inferred1"><a name="line618"></a> 618       # would have slashed-off the path components after the changed action.
</span><span class="marked0"><a name="line619"></a> 619       def url_for(options = {})
</span><span class="uncovered1"><a name="line620"></a> 620         options ||= {}
</span><span class="uncovered0"><a name="line621"></a> 621         case options
</span><span class="uncovered1"><a name="line622"></a> 622           when String
</span><span class="uncovered0"><a name="line623"></a> 623             options
</span><span class="uncovered1"><a name="line624"></a> 624           when Hash
</span><span class="uncovered0"><a name="line625"></a> 625             @url.rewrite(rewrite_options(options))
</span><span class="uncovered1"><a name="line626"></a> 626           else
</span><span class="uncovered0"><a name="line627"></a> 627             polymorphic_url(options)
</span><span class="uncovered1"><a name="line628"></a> 628         end
</span><span class="uncovered0"><a name="line629"></a> 629       end
</span><span class="inferred1"><a name="line630"></a> 630 
</span><span class="inferred0"><a name="line631"></a> 631       # Converts the class name from something like &quot;OneModule::TwoModule::NeatController&quot; to &quot;NeatController&quot;.
</span><span class="marked1"><a name="line632"></a> 632       def controller_class_name
</span><span class="uncovered0"><a name="line633"></a> 633         self.class.controller_class_name
</span><span class="uncovered1"><a name="line634"></a> 634       end
</span><span class="inferred0"><a name="line635"></a> 635 
</span><span class="inferred1"><a name="line636"></a> 636       # Converts the class name from something like &quot;OneModule::TwoModule::NeatController&quot; to &quot;neat&quot;.
</span><span class="marked0"><a name="line637"></a> 637       def controller_name
</span><span class="uncovered1"><a name="line638"></a> 638         self.class.controller_name
</span><span class="uncovered0"><a name="line639"></a> 639       end
</span><span class="inferred1"><a name="line640"></a> 640 
</span><span class="inferred0"><a name="line641"></a> 641       # Converts the class name from something like &quot;OneModule::TwoModule::NeatController&quot; to &quot;one_module/two_module/neat&quot;.
</span><span class="marked1"><a name="line642"></a> 642       def controller_path
</span><span class="uncovered0"><a name="line643"></a> 643         self.class.controller_path
</span><span class="uncovered1"><a name="line644"></a> 644       end
</span><span class="inferred0"><a name="line645"></a> 645 
</span><span class="marked1"><a name="line646"></a> 646       def session_enabled?
</span><span class="uncovered0"><a name="line647"></a> 647         ActiveSupport::Deprecation.warn(&quot;Sessions are now lazy loaded. So if you don't access them, consider them disabled.&quot;, caller)
</span><span class="uncovered1"><a name="line648"></a> 648       end
</span><span class="inferred0"><a name="line649"></a> 649 
</span><span class="marked1"><a name="line650"></a> 650       self.view_paths = []
</span><span class="inferred0"><a name="line651"></a> 651 
</span><span class="inferred1"><a name="line652"></a> 652       # View load paths for controller.
</span><span class="marked0"><a name="line653"></a> 653       def view_paths
</span><span class="uncovered1"><a name="line654"></a> 654         @template.view_paths
</span><span class="uncovered0"><a name="line655"></a> 655       end
</span><span class="inferred1"><a name="line656"></a> 656 
</span><span class="marked0"><a name="line657"></a> 657       def view_paths=(value)
</span><span class="uncovered1"><a name="line658"></a> 658         @template.view_paths = ActionView::Base.process_view_paths(value)
</span><span class="uncovered0"><a name="line659"></a> 659       end
</span><span class="inferred1"><a name="line660"></a> 660 
</span><span class="inferred0"><a name="line661"></a> 661       # Adds a view_path to the front of the view_paths array.
</span><span class="inferred1"><a name="line662"></a> 662       # This change affects the current request only.
</span><span class="inferred0"><a name="line663"></a> 663       #
</span><span class="inferred1"><a name="line664"></a> 664       #   self.prepend_view_path(&quot;views/default&quot;)
</span><span class="inferred0"><a name="line665"></a> 665       #   self.prepend_view_path([&quot;views/default&quot;, &quot;views/custom&quot;])
</span><span class="inferred1"><a name="line666"></a> 666       #
</span><span class="marked0"><a name="line667"></a> 667       def prepend_view_path(path)
</span><span class="uncovered1"><a name="line668"></a> 668         @template.view_paths.unshift(*path)
</span><span class="uncovered0"><a name="line669"></a> 669       end
</span><span class="inferred1"><a name="line670"></a> 670 
</span><span class="inferred0"><a name="line671"></a> 671       # Adds a view_path to the end of the view_paths array.
</span><span class="inferred1"><a name="line672"></a> 672       # This change affects the current request only.
</span><span class="inferred0"><a name="line673"></a> 673       #
</span><span class="inferred1"><a name="line674"></a> 674       #   self.append_view_path(&quot;views/default&quot;)
</span><span class="inferred0"><a name="line675"></a> 675       #   self.append_view_path([&quot;views/default&quot;, &quot;views/custom&quot;])
</span><span class="inferred1"><a name="line676"></a> 676       #
</span><span class="marked0"><a name="line677"></a> 677       def append_view_path(path)
</span><span class="uncovered1"><a name="line678"></a> 678         @template.view_paths.push(*path)
</span><span class="uncovered0"><a name="line679"></a> 679       end
</span><span class="inferred1"><a name="line680"></a> 680 
</span><span class="marked0"><a name="line681"></a> 681     protected
</span><span class="inferred1"><a name="line682"></a> 682       # Renders the content that will be returned to the browser as the response body.
</span><span class="inferred0"><a name="line683"></a> 683       #
</span><span class="inferred1"><a name="line684"></a> 684       # === Rendering an action
</span><span class="inferred0"><a name="line685"></a> 685       #
</span><span class="inferred1"><a name="line686"></a> 686       # Action rendering is the most common form and the type used automatically by Action Controller when nothing else is
</span><span class="inferred0"><a name="line687"></a> 687       # specified. By default, actions are rendered within the current layout (if one exists).
</span><span class="inferred1"><a name="line688"></a> 688       #
</span><span class="inferred0"><a name="line689"></a> 689       #   # Renders the template for the action &quot;goal&quot; within the current controller
</span><span class="inferred1"><a name="line690"></a> 690       #   render :action =&gt; &quot;goal&quot;
</span><span class="inferred0"><a name="line691"></a> 691       #
</span><span class="inferred1"><a name="line692"></a> 692       #   # Renders the template for the action &quot;short_goal&quot; within the current controller,
</span><span class="inferred0"><a name="line693"></a> 693       #   # but without the current active layout
</span><span class="inferred1"><a name="line694"></a> 694       #   render :action =&gt; &quot;short_goal&quot;, :layout =&gt; false
</span><span class="inferred0"><a name="line695"></a> 695       #
</span><span class="inferred1"><a name="line696"></a> 696       #   # Renders the template for the action &quot;long_goal&quot; within the current controller,
</span><span class="inferred0"><a name="line697"></a> 697       #   # but with a custom layout
</span><span class="inferred1"><a name="line698"></a> 698       #   render :action =&gt; &quot;long_goal&quot;, :layout =&gt; &quot;spectacular&quot;
</span><span class="inferred0"><a name="line699"></a> 699       #
</span><span class="inferred1"><a name="line700"></a> 700       # === Rendering partials
</span><span class="inferred0"><a name="line701"></a> 701       #
</span><span class="inferred1"><a name="line702"></a> 702       # Partial rendering in a controller is most commonly used together with Ajax calls that only update one or a few elements on a page
</span><span class="inferred0"><a name="line703"></a> 703       # without reloading. Rendering of partials from the controller makes it possible to use the same partial template in
</span><span class="inferred1"><a name="line704"></a> 704       # both the full-page rendering (by calling it from within the template) and when sub-page updates happen (from the
</span><span class="inferred0"><a name="line705"></a> 705       # controller action responding to Ajax calls). By default, the current layout is not used.
</span><span class="inferred1"><a name="line706"></a> 706       #
</span><span class="inferred0"><a name="line707"></a> 707       #   # Renders the same partial with a local variable.
</span><span class="inferred1"><a name="line708"></a> 708       #   render :partial =&gt; &quot;person&quot;, :locals =&gt; { :name =&gt; &quot;david&quot; }
</span><span class="inferred0"><a name="line709"></a> 709       #
</span><span class="inferred1"><a name="line710"></a> 710       #   # Renders the partial, making @new_person available through
</span><span class="inferred0"><a name="line711"></a> 711       #   # the local variable 'person'
</span><span class="inferred1"><a name="line712"></a> 712       #   render :partial =&gt; &quot;person&quot;, :object =&gt; @new_person
</span><span class="inferred0"><a name="line713"></a> 713       #
</span><span class="inferred1"><a name="line714"></a> 714       #   # Renders a collection of the same partial by making each element
</span><span class="inferred0"><a name="line715"></a> 715       #   # of @winners available through the local variable &quot;person&quot; as it
</span><span class="inferred1"><a name="line716"></a> 716       #   # builds the complete response.
</span><span class="inferred0"><a name="line717"></a> 717       #   render :partial =&gt; &quot;person&quot;, :collection =&gt; @winners
</span><span class="inferred1"><a name="line718"></a> 718       #
</span><span class="inferred0"><a name="line719"></a> 719       #   # Renders a collection of partials but with a custom local variable name
</span><span class="inferred1"><a name="line720"></a> 720       #   render :partial =&gt; &quot;admin_person&quot;, :collection =&gt; @winners, :as =&gt; :person
</span><span class="inferred0"><a name="line721"></a> 721       #
</span><span class="inferred1"><a name="line722"></a> 722       #   # Renders the same collection of partials, but also renders the
</span><span class="inferred0"><a name="line723"></a> 723       #   # person_divider partial between each person partial.
</span><span class="inferred1"><a name="line724"></a> 724       #   render :partial =&gt; &quot;person&quot;, :collection =&gt; @winners, :spacer_template =&gt; &quot;person_divider&quot;
</span><span class="inferred0"><a name="line725"></a> 725       #
</span><span class="inferred1"><a name="line726"></a> 726       #   # Renders a collection of partials located in a view subfolder
</span><span class="inferred0"><a name="line727"></a> 727       #   # outside of our current controller.  In this example we will be
</span><span class="inferred1"><a name="line728"></a> 728       #   # rendering app/views/shared/_note.r(html|xml)  Inside the partial
</span><span class="inferred0"><a name="line729"></a> 729       #   # each element of @new_notes is available as the local var &quot;note&quot;.
</span><span class="inferred1"><a name="line730"></a> 730       #   render :partial =&gt; &quot;shared/note&quot;, :collection =&gt; @new_notes
</span><span class="inferred0"><a name="line731"></a> 731       #
</span><span class="inferred1"><a name="line732"></a> 732       #   # Renders the partial with a status code of 500 (internal error).
</span><span class="inferred0"><a name="line733"></a> 733       #   render :partial =&gt; &quot;broken&quot;, :status =&gt; 500
</span><span class="inferred1"><a name="line734"></a> 734       #
</span><span class="inferred0"><a name="line735"></a> 735       # Note that the partial filename must also be a valid Ruby variable name,
</span><span class="inferred1"><a name="line736"></a> 736       # so e.g. 2005 and register-user are invalid.
</span><span class="inferred0"><a name="line737"></a> 737       #
</span><span class="inferred1"><a name="line738"></a> 738       #
</span><span class="inferred0"><a name="line739"></a> 739       # == Automatic etagging
</span><span class="inferred1"><a name="line740"></a> 740       #
</span><span class="inferred0"><a name="line741"></a> 741       # Rendering will automatically insert the etag header on 200 OK responses. The etag is calculated using MD5 of the
</span><span class="inferred1"><a name="line742"></a> 742       # response body. If a request comes in that has a matching etag, the response will be changed to a 304 Not Modified
</span><span class="inferred0"><a name="line743"></a> 743       # and the response body will be set to an empty string. No etag header will be inserted if it's already set.
</span><span class="inferred1"><a name="line744"></a> 744       #
</span><span class="inferred0"><a name="line745"></a> 745       # === Rendering a template
</span><span class="inferred1"><a name="line746"></a> 746       #
</span><span class="inferred0"><a name="line747"></a> 747       # Template rendering works just like action rendering except that it takes a path relative to the template root.
</span><span class="inferred1"><a name="line748"></a> 748       # The current layout is automatically applied.
</span><span class="inferred0"><a name="line749"></a> 749       #
</span><span class="inferred1"><a name="line750"></a> 750       #   # Renders the template located in [TEMPLATE_ROOT]/weblog/show.r(html|xml) (in Rails, app/views/weblog/show.erb)
</span><span class="inferred0"><a name="line751"></a> 751       #   render :template =&gt; &quot;weblog/show&quot;
</span><span class="inferred1"><a name="line752"></a> 752       #
</span><span class="inferred0"><a name="line753"></a> 753       #   # Renders the template with a local variable
</span><span class="inferred1"><a name="line754"></a> 754       #   render :template =&gt; &quot;weblog/show&quot;, :locals =&gt; {:customer =&gt; Customer.new}
</span><span class="inferred0"><a name="line755"></a> 755       #
</span><span class="inferred1"><a name="line756"></a> 756       # === Rendering a file
</span><span class="inferred0"><a name="line757"></a> 757       #
</span><span class="inferred1"><a name="line758"></a> 758       # File rendering works just like action rendering except that it takes a filesystem path. By default, the path
</span><span class="inferred0"><a name="line759"></a> 759       # is assumed to be absolute, and the current layout is not applied.
</span><span class="inferred1"><a name="line760"></a> 760       #
</span><span class="inferred0"><a name="line761"></a> 761       #   # Renders the template located at the absolute filesystem path
</span><span class="inferred1"><a name="line762"></a> 762       #   render :file =&gt; &quot;/path/to/some/template.erb&quot;
</span><span class="inferred0"><a name="line763"></a> 763       #   render :file =&gt; &quot;c:/path/to/some/template.erb&quot;
</span><span class="inferred1"><a name="line764"></a> 764       #
</span><span class="inferred0"><a name="line765"></a> 765       #   # Renders a template within the current layout, and with a 404 status code
</span><span class="inferred1"><a name="line766"></a> 766       #   render :file =&gt; &quot;/path/to/some/template.erb&quot;, :layout =&gt; true, :status =&gt; 404
</span><span class="inferred0"><a name="line767"></a> 767       #   render :file =&gt; &quot;c:/path/to/some/template.erb&quot;, :layout =&gt; true, :status =&gt; 404
</span><span class="inferred1"><a name="line768"></a> 768       #
</span><span class="inferred0"><a name="line769"></a> 769       # === Rendering text
</span><span class="inferred1"><a name="line770"></a> 770       #
</span><span class="inferred0"><a name="line771"></a> 771       # Rendering of text is usually used for tests or for rendering prepared content, such as a cache. By default, text
</span><span class="inferred1"><a name="line772"></a> 772       # rendering is not done within the active layout.
</span><span class="inferred0"><a name="line773"></a> 773       #
</span><span class="inferred1"><a name="line774"></a> 774       #   # Renders the clear text &quot;hello world&quot; with status code 200
</span><span class="inferred0"><a name="line775"></a> 775       #   render :text =&gt; &quot;hello world!&quot;
</span><span class="inferred1"><a name="line776"></a> 776       #
</span><span class="inferred0"><a name="line777"></a> 777       #   # Renders the clear text &quot;Explosion!&quot;  with status code 500
</span><span class="inferred1"><a name="line778"></a> 778       #   render :text =&gt; &quot;Explosion!&quot;, :status =&gt; 500
</span><span class="inferred0"><a name="line779"></a> 779       #
</span><span class="inferred1"><a name="line780"></a> 780       #   # Renders the clear text &quot;Hi there!&quot; within the current active layout (if one exists)
</span><span class="inferred0"><a name="line781"></a> 781       #   render :text =&gt; &quot;Hi there!&quot;, :layout =&gt; true
</span><span class="inferred1"><a name="line782"></a> 782       #
</span><span class="inferred0"><a name="line783"></a> 783       #   # Renders the clear text &quot;Hi there!&quot; within the layout
</span><span class="inferred1"><a name="line784"></a> 784       #   # placed in &quot;app/views/layouts/special.r(html|xml)&quot;
</span><span class="inferred0"><a name="line785"></a> 785       #   render :text =&gt; &quot;Hi there!&quot;, :layout =&gt; &quot;special&quot;
</span><span class="inferred1"><a name="line786"></a> 786       #
</span><span class="inferred0"><a name="line787"></a> 787       # The &lt;tt&gt;:text&lt;/tt&gt; option can also accept a Proc object, which can be used to manually control the page generation. This should
</span><span class="inferred1"><a name="line788"></a> 788       # generally be avoided, as it violates the separation between code and content, and because almost everything that can be
</span><span class="inferred0"><a name="line789"></a> 789       # done with this method can also be done more cleanly using one of the other rendering methods, most notably templates.
</span><span class="inferred1"><a name="line790"></a> 790       #
</span><span class="inferred0"><a name="line791"></a> 791       #   # Renders &quot;Hello from code!&quot;
</span><span class="inferred1"><a name="line792"></a> 792       #   render :text =&gt; proc { |response, output| output.write(&quot;Hello from code!&quot;) }
</span><span class="inferred0"><a name="line793"></a> 793       #
</span><span class="inferred1"><a name="line794"></a> 794       # === Rendering XML
</span><span class="inferred0"><a name="line795"></a> 795       #
</span><span class="inferred1"><a name="line796"></a> 796       # Rendering XML sets the content type to application/xml.
</span><span class="inferred0"><a name="line797"></a> 797       #
</span><span class="inferred1"><a name="line798"></a> 798       #   # Renders '&lt;name&gt;David&lt;/name&gt;'
</span><span class="inferred0"><a name="line799"></a> 799       #   render :xml =&gt; {:name =&gt; &quot;David&quot;}.to_xml
</span><span class="inferred1"><a name="line800"></a> 800       #
</span><span class="inferred0"><a name="line801"></a> 801       # It's not necessary to call &lt;tt&gt;to_xml&lt;/tt&gt; on the object you want to render, since &lt;tt&gt;render&lt;/tt&gt; will
</span><span class="inferred1"><a name="line802"></a> 802       # automatically do that for you:
</span><span class="inferred0"><a name="line803"></a> 803       #
</span><span class="inferred1"><a name="line804"></a> 804       #   # Also renders '&lt;name&gt;David&lt;/name&gt;'
</span><span class="inferred0"><a name="line805"></a> 805       #   render :xml =&gt; {:name =&gt; &quot;David&quot;}
</span><span class="inferred1"><a name="line806"></a> 806       #
</span><span class="inferred0"><a name="line807"></a> 807       # === Rendering JSON
</span><span class="inferred1"><a name="line808"></a> 808       #
</span><span class="inferred0"><a name="line809"></a> 809       # Rendering JSON sets the content type to application/json and optionally wraps the JSON in a callback. It is expected
</span><span class="inferred1"><a name="line810"></a> 810       # that the response will be parsed (or eval'd) for use as a data structure.
</span><span class="inferred0"><a name="line811"></a> 811       #
</span><span class="inferred1"><a name="line812"></a> 812       #   # Renders '{&quot;name&quot;: &quot;David&quot;}'
</span><span class="inferred0"><a name="line813"></a> 813       #   render :json =&gt; {:name =&gt; &quot;David&quot;}.to_json
</span><span class="inferred1"><a name="line814"></a> 814       #
</span><span class="inferred0"><a name="line815"></a> 815       # It's not necessary to call &lt;tt&gt;to_json&lt;/tt&gt; on the object you want to render, since &lt;tt&gt;render&lt;/tt&gt; will
</span><span class="inferred1"><a name="line816"></a> 816       # automatically do that for you:
</span><span class="inferred0"><a name="line817"></a> 817       #
</span><span class="inferred1"><a name="line818"></a> 818       #   # Also renders '{&quot;name&quot;: &quot;David&quot;}'
</span><span class="inferred0"><a name="line819"></a> 819       #   render :json =&gt; {:name =&gt; &quot;David&quot;}
</span><span class="inferred1"><a name="line820"></a> 820       #
</span><span class="inferred0"><a name="line821"></a> 821       # Sometimes the result isn't handled directly by a script (such as when the request comes from a SCRIPT tag),
</span><span class="inferred1"><a name="line822"></a> 822       # so the &lt;tt&gt;:callback&lt;/tt&gt; option is provided for these cases.
</span><span class="inferred0"><a name="line823"></a> 823       #
</span><span class="inferred1"><a name="line824"></a> 824       #   # Renders 'show({&quot;name&quot;: &quot;David&quot;})'
</span><span class="inferred0"><a name="line825"></a> 825       #   render :json =&gt; {:name =&gt; &quot;David&quot;}.to_json, :callback =&gt; 'show'
</span><span class="inferred1"><a name="line826"></a> 826       #
</span><span class="inferred0"><a name="line827"></a> 827       # === Rendering an inline template
</span><span class="inferred1"><a name="line828"></a> 828       #
</span><span class="inferred0"><a name="line829"></a> 829       # Rendering of an inline template works as a cross between text and action rendering where the source for the template
</span><span class="inferred1"><a name="line830"></a> 830       # is supplied inline, like text, but its interpreted with ERb or Builder, like action. By default, ERb is used for rendering
</span><span class="inferred0"><a name="line831"></a> 831       # and the current layout is not used.
</span><span class="inferred1"><a name="line832"></a> 832       #
</span><span class="inferred0"><a name="line833"></a> 833       #   # Renders &quot;hello, hello, hello, again&quot;
</span><span class="inferred1"><a name="line834"></a> 834       #   render :inline =&gt; &quot;&lt;%= 'hello, ' * 3 + 'again' %&gt;&quot;
</span><span class="inferred0"><a name="line835"></a> 835       #
</span><span class="inferred1"><a name="line836"></a> 836       #   # Renders &quot;&lt;p&gt;Good seeing you!&lt;/p&gt;&quot; using Builder
</span><span class="inferred0"><a name="line837"></a> 837       #   render :inline =&gt; &quot;xml.p { 'Good seeing you!' }&quot;, :type =&gt; :builder
</span><span class="inferred1"><a name="line838"></a> 838       #
</span><span class="inferred0"><a name="line839"></a> 839       #   # Renders &quot;hello david&quot;
</span><span class="inferred1"><a name="line840"></a> 840       #   render :inline =&gt; &quot;&lt;%= 'hello ' + name %&gt;&quot;, :locals =&gt; { :name =&gt; &quot;david&quot; }
</span><span class="inferred0"><a name="line841"></a> 841       #
</span><span class="inferred1"><a name="line842"></a> 842       # === Rendering inline JavaScriptGenerator page updates
</span><span class="inferred0"><a name="line843"></a> 843       #
</span><span class="inferred1"><a name="line844"></a> 844       # In addition to rendering JavaScriptGenerator page updates with Ajax in RJS templates (see ActionView::Base for details),
</span><span class="inferred0"><a name="line845"></a> 845       # you can also pass the &lt;tt&gt;:update&lt;/tt&gt; parameter to +render+, along with a block, to render page updates inline.
</span><span class="inferred1"><a name="line846"></a> 846       #
</span><span class="inferred0"><a name="line847"></a> 847       #   render :update do |page|
</span><span class="inferred1"><a name="line848"></a> 848       #     page.replace_html  'user_list', :partial =&gt; 'user', :collection =&gt; @users
</span><span class="inferred0"><a name="line849"></a> 849       #     page.visual_effect :highlight, 'user_list'
</span><span class="inferred1"><a name="line850"></a> 850       #   end
</span><span class="inferred0"><a name="line851"></a> 851       #
</span><span class="inferred1"><a name="line852"></a> 852       # === Rendering vanilla JavaScript
</span><span class="inferred0"><a name="line853"></a> 853       #
</span><span class="inferred1"><a name="line854"></a> 854       # In addition to using RJS with render :update, you can also just render vanilla JavaScript with :js.
</span><span class="inferred0"><a name="line855"></a> 855       #
</span><span class="inferred1"><a name="line856"></a> 856       #   # Renders &quot;alert('hello')&quot; and sets the mime type to text/javascript
</span><span class="inferred0"><a name="line857"></a> 857       #   render :js =&gt; &quot;alert('hello')&quot;
</span><span class="inferred1"><a name="line858"></a> 858       #
</span><span class="inferred0"><a name="line859"></a> 859       # === Rendering with status and location headers
</span><span class="inferred1"><a name="line860"></a> 860       # All renders take the &lt;tt&gt;:status&lt;/tt&gt; and &lt;tt&gt;:location&lt;/tt&gt; options and turn them into headers. They can even be used together:
</span><span class="inferred0"><a name="line861"></a> 861       #
</span><span class="inferred1"><a name="line862"></a> 862       #   render :xml =&gt; post.to_xml, :status =&gt; :created, :location =&gt; post_url(post)
</span><span class="marked0"><a name="line863"></a> 863       def render(options = nil, extra_options = {}, &amp;block) #:doc:
</span><span class="uncovered1"><a name="line864"></a> 864         raise DoubleRenderError, &quot;Can only render or redirect once per action&quot; if performed?
</span><span class="uncovered0"><a name="line865"></a> 865 
</span><span class="uncovered1"><a name="line866"></a> 866         validate_render_arguments(options, extra_options, block_given?)
</span><span class="uncovered0"><a name="line867"></a> 867 
</span><span class="uncovered1"><a name="line868"></a> 868         if options.nil?
</span><span class="uncovered0"><a name="line869"></a> 869           options = { :template =&gt; default_template, :layout =&gt; true }
</span><span class="uncovered1"><a name="line870"></a> 870         elsif options == :update
</span><span class="uncovered0"><a name="line871"></a> 871           options = extra_options.merge({ :update =&gt; true })
</span><span class="uncovered1"><a name="line872"></a> 872         elsif options.is_a?(String) || options.is_a?(Symbol)
</span><span class="uncovered0"><a name="line873"></a> 873           case options.to_s.index('/')
</span><span class="uncovered1"><a name="line874"></a> 874           when 0
</span><span class="uncovered0"><a name="line875"></a> 875             extra_options[:file] = options
</span><span class="uncovered1"><a name="line876"></a> 876           when nil
</span><span class="uncovered0"><a name="line877"></a> 877             extra_options[:action] = options
</span><span class="uncovered1"><a name="line878"></a> 878           else
</span><span class="uncovered0"><a name="line879"></a> 879             extra_options[:template] = options
</span><span class="uncovered1"><a name="line880"></a> 880           end
</span><span class="uncovered0"><a name="line881"></a> 881 
</span><span class="uncovered1"><a name="line882"></a> 882           options = extra_options
</span><span class="uncovered0"><a name="line883"></a> 883         end
</span><span class="uncovered1"><a name="line884"></a> 884 
</span><span class="uncovered0"><a name="line885"></a> 885         layout = pick_layout(options)
</span><span class="uncovered1"><a name="line886"></a> 886         response.layout = layout.path_without_format_and_extension if layout
</span><span class="uncovered0"><a name="line887"></a> 887         logger.info(&quot;Rendering template within #{layout.path_without_format_and_extension}&quot;) if logger &amp;&amp; layout
</span><span class="uncovered1"><a name="line888"></a> 888 
</span><span class="uncovered0"><a name="line889"></a> 889         if content_type = options[:content_type]
</span><span class="uncovered1"><a name="line890"></a> 890           response.content_type = content_type.to_s
</span><span class="uncovered0"><a name="line891"></a> 891         end
</span><span class="uncovered1"><a name="line892"></a> 892 
</span><span class="uncovered0"><a name="line893"></a> 893         if location = options[:location]
</span><span class="uncovered1"><a name="line894"></a> 894           response.headers[&quot;Location&quot;] = url_for(location)
</span><span class="uncovered0"><a name="line895"></a> 895         end
</span><span class="uncovered1"><a name="line896"></a> 896 
</span><span class="uncovered0"><a name="line897"></a> 897         if options.has_key?(:text)
</span><span class="uncovered1"><a name="line898"></a> 898           text = layout ? @template.render(options.merge(:text =&gt; options[:text], :layout =&gt; layout)) : options[:text]
</span><span class="uncovered0"><a name="line899"></a> 899           render_for_text(text, options[:status])
</span><span class="uncovered1"><a name="line900"></a> 900 
</span><span class="uncovered0"><a name="line901"></a> 901         else
</span><span class="uncovered1"><a name="line902"></a> 902           if file = options[:file]
</span><span class="uncovered0"><a name="line903"></a> 903             render_for_file(file, options[:status], layout, options[:locals] || {})
</span><span class="uncovered1"><a name="line904"></a> 904 
</span><span class="uncovered0"><a name="line905"></a> 905           elsif template = options[:template]
</span><span class="uncovered1"><a name="line906"></a> 906             render_for_file(template, options[:status], layout, options[:locals] || {})
</span><span class="uncovered0"><a name="line907"></a> 907 
</span><span class="uncovered1"><a name="line908"></a> 908           elsif inline = options[:inline]
</span><span class="uncovered0"><a name="line909"></a> 909             render_for_text(@template.render(options.merge(:layout =&gt; layout)), options[:status])
</span><span class="uncovered1"><a name="line910"></a> 910 
</span><span class="uncovered0"><a name="line911"></a> 911           elsif action_name = options[:action]
</span><span class="uncovered1"><a name="line912"></a> 912             render_for_file(default_template(action_name.to_s), options[:status], layout)
</span><span class="uncovered0"><a name="line913"></a> 913 
</span><span class="uncovered1"><a name="line914"></a> 914           elsif xml = options[:xml]
</span><span class="uncovered0"><a name="line915"></a> 915             response.content_type ||= Mime::XML
</span><span class="uncovered1"><a name="line916"></a> 916             render_for_text(xml.respond_to?(:to_xml) ? xml.to_xml : xml, options[:status])
</span><span class="uncovered0"><a name="line917"></a> 917 
</span><span class="uncovered1"><a name="line918"></a> 918           elsif js = options[:js]
</span><span class="uncovered0"><a name="line919"></a> 919             response.content_type ||= Mime::JS
</span><span class="uncovered1"><a name="line920"></a> 920             render_for_text(js, options[:status])
</span><span class="uncovered0"><a name="line921"></a> 921 
</span><span class="uncovered1"><a name="line922"></a> 922           elsif json = options[:json]
</span><span class="uncovered0"><a name="line923"></a> 923             json = json.to_json unless json.is_a?(String)
</span><span class="uncovered1"><a name="line924"></a> 924             json = &quot;#{options[:callback]}(#{json})&quot; unless options[:callback].blank?
</span><span class="uncovered0"><a name="line925"></a> 925             response.content_type ||= Mime::JSON
</span><span class="uncovered1"><a name="line926"></a> 926             render_for_text(json, options[:status])
</span><span class="uncovered0"><a name="line927"></a> 927 
</span><span class="uncovered1"><a name="line928"></a> 928           elsif options[:partial]
</span><span class="uncovered0"><a name="line929"></a> 929             options[:partial] = default_template_name if options[:partial] == true
</span><span class="uncovered1"><a name="line930"></a> 930             if layout
</span><span class="uncovered0"><a name="line931"></a> 931               render_for_text(@template.render(:text =&gt; @template.render(options), :layout =&gt; layout), options[:status])
</span><span class="uncovered1"><a name="line932"></a> 932             else
</span><span class="uncovered0"><a name="line933"></a> 933               render_for_text(@template.render(options), options[:status])
</span><span class="uncovered1"><a name="line934"></a> 934             end
</span><span class="uncovered0"><a name="line935"></a> 935 
</span><span class="uncovered1"><a name="line936"></a> 936           elsif options[:update]
</span><span class="uncovered0"><a name="line937"></a> 937             @template.send(:_evaluate_assigns_and_ivars)
</span><span class="uncovered1"><a name="line938"></a> 938 
</span><span class="uncovered0"><a name="line939"></a> 939             generator = ActionView::Helpers::PrototypeHelper::JavaScriptGenerator.new(@template, &amp;block)
</span><span class="uncovered1"><a name="line940"></a> 940             response.content_type = Mime::JS
</span><span class="uncovered0"><a name="line941"></a> 941             render_for_text(generator.to_s, options[:status])
</span><span class="uncovered1"><a name="line942"></a> 942 
</span><span class="uncovered0"><a name="line943"></a> 943           elsif options[:nothing]
</span><span class="uncovered1"><a name="line944"></a> 944             render_for_text(nil, options[:status])
</span><span class="uncovered0"><a name="line945"></a> 945 
</span><span class="uncovered1"><a name="line946"></a> 946           else
</span><span class="uncovered0"><a name="line947"></a> 947             render_for_file(default_template, options[:status], layout)
</span><span class="uncovered1"><a name="line948"></a> 948           end
</span><span class="uncovered0"><a name="line949"></a> 949         end
</span><span class="uncovered1"><a name="line950"></a> 950       end
</span><span class="inferred0"><a name="line951"></a> 951 
</span><span class="inferred1"><a name="line952"></a> 952       # Renders according to the same rules as &lt;tt&gt;render&lt;/tt&gt;, but returns the result in a string instead
</span><span class="inferred0"><a name="line953"></a> 953       # of sending it as the response body to the browser.
</span><span class="marked1"><a name="line954"></a> 954       def render_to_string(options = nil, &amp;block) #:doc:
</span><span class="uncovered0"><a name="line955"></a> 955         render(options, &amp;block)
</span><span class="uncovered1"><a name="line956"></a> 956       ensure
</span><span class="uncovered0"><a name="line957"></a> 957         response.content_type = nil
</span><span class="uncovered1"><a name="line958"></a> 958         erase_render_results
</span><span class="uncovered0"><a name="line959"></a> 959         reset_variables_added_to_assigns
</span><span class="uncovered1"><a name="line960"></a> 960       end
</span><span class="inferred0"><a name="line961"></a> 961 
</span><span class="inferred1"><a name="line962"></a> 962       # Return a response that has no content (merely headers). The options
</span><span class="inferred0"><a name="line963"></a> 963       # argument is interpreted to be a hash of header names and values.
</span><span class="inferred1"><a name="line964"></a> 964       # This allows you to easily return a response that consists only of
</span><span class="inferred0"><a name="line965"></a> 965       # significant headers:
</span><span class="inferred1"><a name="line966"></a> 966       #
</span><span class="inferred0"><a name="line967"></a> 967       #   head :created, :location =&gt; person_path(@person)
</span><span class="inferred1"><a name="line968"></a> 968       #
</span><span class="inferred0"><a name="line969"></a> 969       # It can also be used to return exceptional conditions:
</span><span class="inferred1"><a name="line970"></a> 970       #
</span><span class="inferred0"><a name="line971"></a> 971       #   return head(:method_not_allowed) unless request.post?
</span><span class="inferred1"><a name="line972"></a> 972       #   return head(:bad_request) unless valid_request?
</span><span class="inferred0"><a name="line973"></a> 973       #   render
</span><span class="marked1"><a name="line974"></a> 974       def head(*args)
</span><span class="uncovered0"><a name="line975"></a> 975         if args.length &gt; 2
</span><span class="uncovered1"><a name="line976"></a> 976           raise ArgumentError, &quot;too many arguments to head&quot;
</span><span class="uncovered0"><a name="line977"></a> 977         elsif args.empty?
</span><span class="uncovered1"><a name="line978"></a> 978           raise ArgumentError, &quot;too few arguments to head&quot;
</span><span class="uncovered0"><a name="line979"></a> 979         end
</span><span class="uncovered1"><a name="line980"></a> 980         options = args.extract_options!
</span><span class="uncovered0"><a name="line981"></a> 981         status = interpret_status(args.shift || options.delete(:status) || :ok)
</span><span class="uncovered1"><a name="line982"></a> 982 
</span><span class="uncovered0"><a name="line983"></a> 983         options.each do |key, value|
</span><span class="uncovered1"><a name="line984"></a> 984           headers[key.to_s.dasherize.split(/-/).map { |v| v.capitalize }.join(&quot;-&quot;)] = value.to_s
</span><span class="uncovered0"><a name="line985"></a> 985         end
</span><span class="uncovered1"><a name="line986"></a> 986 
</span><span class="uncovered0"><a name="line987"></a> 987         render :nothing =&gt; true, :status =&gt; status
</span><span class="uncovered1"><a name="line988"></a> 988       end
</span><span class="inferred0"><a name="line989"></a> 989 
</span><span class="inferred1"><a name="line990"></a> 990       # Clears the rendered results, allowing for another render to be performed.
</span><span class="marked0"><a name="line991"></a> 991       def erase_render_results #:nodoc:
</span><span class="uncovered1"><a name="line992"></a> 992         response.body = nil
</span><span class="uncovered0"><a name="line993"></a> 993         @performed_render = false
</span><span class="uncovered1"><a name="line994"></a> 994       end
</span><span class="inferred0"><a name="line995"></a> 995 
</span><span class="inferred1"><a name="line996"></a> 996       # Clears the redirected results from the headers, resets the status to 200 and returns
</span><span class="inferred0"><a name="line997"></a> 997       # the URL that was used to redirect or nil if there was no redirected URL
</span><span class="inferred1"><a name="line998"></a> 998       # Note that +redirect_to+ will change the body of the response to indicate a redirection.
</span><span class="inferred0"><a name="line999"></a> 999       # The response body is not reset here, see +erase_render_results+
</span><span class="marked1"><a name="line1000"></a>1000       def erase_redirect_results #:nodoc:
</span><span class="uncovered0"><a name="line1001"></a>1001         @performed_redirect = false
</span><span class="uncovered1"><a name="line1002"></a>1002         response.redirected_to = nil
</span><span class="uncovered0"><a name="line1003"></a>1003         response.redirected_to_method_params = nil
</span><span class="uncovered1"><a name="line1004"></a>1004         response.status = DEFAULT_RENDER_STATUS_CODE
</span><span class="uncovered0"><a name="line1005"></a>1005         response.headers.delete('Location')
</span><span class="uncovered1"><a name="line1006"></a>1006       end
</span><span class="inferred0"><a name="line1007"></a>1007 
</span><span class="inferred1"><a name="line1008"></a>1008       # Erase both render and redirect results
</span><span class="marked0"><a name="line1009"></a>1009       def erase_results #:nodoc:
</span><span class="uncovered1"><a name="line1010"></a>1010         erase_render_results
</span><span class="uncovered0"><a name="line1011"></a>1011         erase_redirect_results
</span><span class="uncovered1"><a name="line1012"></a>1012       end
</span><span class="inferred0"><a name="line1013"></a>1013 
</span><span class="marked1"><a name="line1014"></a>1014       def rewrite_options(options) #:nodoc:
</span><span class="uncovered0"><a name="line1015"></a>1015         if defaults = default_url_options(options)
</span><span class="uncovered1"><a name="line1016"></a>1016           defaults.merge(options)
</span><span class="uncovered0"><a name="line1017"></a>1017         else
</span><span class="uncovered1"><a name="line1018"></a>1018           options
</span><span class="uncovered0"><a name="line1019"></a>1019         end
</span><span class="uncovered1"><a name="line1020"></a>1020       end
</span><span class="inferred0"><a name="line1021"></a>1021 
</span><span class="inferred1"><a name="line1022"></a>1022       # Overwrite to implement a number of default options that all url_for-based methods will use. The default options should come in
</span><span class="inferred0"><a name="line1023"></a>1023       # the form of a hash, just like the one you would use for url_for directly. Example:
</span><span class="inferred1"><a name="line1024"></a>1024       #
</span><span class="inferred0"><a name="line1025"></a>1025       #   def default_url_options(options)
</span><span class="inferred1"><a name="line1026"></a>1026       #     { :project =&gt; @project.active? ? @project.url_name : &quot;unknown&quot; }
</span><span class="inferred0"><a name="line1027"></a>1027       #   end
</span><span class="inferred1"><a name="line1028"></a>1028       #
</span><span class="inferred0"><a name="line1029"></a>1029       # As you can infer from the example, this is mostly useful for situations where you want to centralize dynamic decisions about the
</span><span class="inferred1"><a name="line1030"></a>1030       # urls as they stem from the business domain. Please note that any individual url_for call can always override the defaults set
</span><span class="inferred0"><a name="line1031"></a>1031       # by this method.
</span><span class="marked1"><a name="line1032"></a>1032       def default_url_options(options = nil)
</span><span class="inferred0"><a name="line1033"></a>1033       end
</span><span class="inferred1"><a name="line1034"></a>1034 
</span><span class="inferred0"><a name="line1035"></a>1035       # Redirects the browser to the target specified in +options+. This parameter can take one of three forms:
</span><span class="inferred1"><a name="line1036"></a>1036       #
</span><span class="inferred0"><a name="line1037"></a>1037       # * &lt;tt&gt;Hash&lt;/tt&gt; - The URL will be generated by calling url_for with the +options+.
</span><span class="inferred1"><a name="line1038"></a>1038       # * &lt;tt&gt;Record&lt;/tt&gt; - The URL will be generated by calling url_for with the +options+, which will reference a named URL for that record.
</span><span class="inferred0"><a name="line1039"></a>1039       # * &lt;tt&gt;String&lt;/tt&gt; starting with &lt;tt&gt;protocol://&lt;/tt&gt; (like &lt;tt&gt;http://&lt;/tt&gt;) - Is passed straight through as the target for redirection.
</span><span class="inferred1"><a name="line1040"></a>1040       # * &lt;tt&gt;String&lt;/tt&gt; not containing a protocol - The current protocol and host is prepended to the string.
</span><span class="inferred0"><a name="line1041"></a>1041       # * &lt;tt&gt;:back&lt;/tt&gt; - Back to the page that issued the request. Useful for forms that are triggered from multiple places.
</span><span class="inferred1"><a name="line1042"></a>1042       #   Short-hand for &lt;tt&gt;redirect_to(request.env[&quot;HTTP_REFERER&quot;])&lt;/tt&gt;
</span><span class="inferred0"><a name="line1043"></a>1043       #
</span><span class="inferred1"><a name="line1044"></a>1044       # Examples:
</span><span class="inferred0"><a name="line1045"></a>1045       #   redirect_to :action =&gt; &quot;show&quot;, :id =&gt; 5
</span><span class="inferred1"><a name="line1046"></a>1046       #   redirect_to post
</span><span class="inferred0"><a name="line1047"></a>1047       #   redirect_to &quot;http://www.rubyonrails.org&quot;
</span><span class="inferred1"><a name="line1048"></a>1048       #   redirect_to &quot;/images/screenshot.jpg&quot;
</span><span class="inferred0"><a name="line1049"></a>1049       #   redirect_to articles_url
</span><span class="inferred1"><a name="line1050"></a>1050       #   redirect_to :back
</span><span class="inferred0"><a name="line1051"></a>1051       #
</span><span class="inferred1"><a name="line1052"></a>1052       # The redirection happens as a &quot;302 Moved&quot; header unless otherwise specified.
</span><span class="inferred0"><a name="line1053"></a>1053       #
</span><span class="inferred1"><a name="line1054"></a>1054       # Examples:
</span><span class="inferred0"><a name="line1055"></a>1055       #   redirect_to post_url(@post), :status=&gt;:found
</span><span class="inferred1"><a name="line1056"></a>1056       #   redirect_to :action=&gt;'atom', :status=&gt;:moved_permanently
</span><span class="inferred0"><a name="line1057"></a>1057       #   redirect_to post_url(@post), :status=&gt;301
</span><span class="inferred1"><a name="line1058"></a>1058       #   redirect_to :action=&gt;'atom', :status=&gt;302
</span><span class="inferred0"><a name="line1059"></a>1059       #
</span><span class="inferred1"><a name="line1060"></a>1060       # When using &lt;tt&gt;redirect_to :back&lt;/tt&gt;, if there is no referrer,
</span><span class="inferred0"><a name="line1061"></a>1061       # RedirectBackError will be raised. You may specify some fallback
</span><span class="inferred1"><a name="line1062"></a>1062       # behavior for this case by rescuing RedirectBackError.
</span><span class="marked0"><a name="line1063"></a>1063       def redirect_to(options = {}, response_status = {}) #:doc:
</span><span class="uncovered1"><a name="line1064"></a>1064         raise ActionControllerError.new(&quot;Cannot redirect to nil!&quot;) if options.nil?
</span><span class="uncovered0"><a name="line1065"></a>1065 
</span><span class="uncovered1"><a name="line1066"></a>1066         if options.is_a?(Hash) &amp;&amp; options[:status]
</span><span class="uncovered0"><a name="line1067"></a>1067           status = options.delete(:status)
</span><span class="uncovered1"><a name="line1068"></a>1068         elsif response_status[:status]
</span><span class="uncovered0"><a name="line1069"></a>1069           status = response_status[:status]
</span><span class="uncovered1"><a name="line1070"></a>1070         else
</span><span class="uncovered0"><a name="line1071"></a>1071           status = 302
</span><span class="uncovered1"><a name="line1072"></a>1072         end
</span><span class="uncovered0"><a name="line1073"></a>1073 
</span><span class="uncovered1"><a name="line1074"></a>1074         response.redirected_to = options
</span><span class="uncovered0"><a name="line1075"></a>1075         logger.info(&quot;Redirected to #{options}&quot;) if logger &amp;&amp; logger.info?
</span><span class="uncovered1"><a name="line1076"></a>1076 
</span><span class="uncovered0"><a name="line1077"></a>1077         case options
</span><span class="uncovered1"><a name="line1078"></a>1078           # The scheme name consist of a letter followed by any combination of
</span><span class="uncovered0"><a name="line1079"></a>1079           # letters, digits, and the plus (&quot;+&quot;), period (&quot;.&quot;), or hyphen (&quot;-&quot;)
</span><span class="uncovered1"><a name="line1080"></a>1080           # characters; and is terminated by a colon (&quot;:&quot;).
</span><span class="uncovered0"><a name="line1081"></a>1081           when %r{^\w[\w\d+.-]*:.*}
</span><span class="uncovered1"><a name="line1082"></a>1082             redirect_to_full_url(options, status)
</span><span class="uncovered0"><a name="line1083"></a>1083           when String
</span><span class="uncovered1"><a name="line1084"></a>1084             redirect_to_full_url(request.protocol + request.host_with_port + options, status)
</span><span class="uncovered0"><a name="line1085"></a>1085           when :back
</span><span class="uncovered1"><a name="line1086"></a>1086             if referer = request.headers[&quot;Referer&quot;]
</span><span class="uncovered0"><a name="line1087"></a>1087               redirect_to(referer, :status=&gt;status)
</span><span class="uncovered1"><a name="line1088"></a>1088             else
</span><span class="uncovered0"><a name="line1089"></a>1089               raise RedirectBackError
</span><span class="uncovered1"><a name="line1090"></a>1090             end
</span><span class="uncovered0"><a name="line1091"></a>1091           else
</span><span class="uncovered1"><a name="line1092"></a>1092             redirect_to_full_url(url_for(options), status)
</span><span class="uncovered0"><a name="line1093"></a>1093         end
</span><span class="uncovered1"><a name="line1094"></a>1094       end
</span><span class="inferred0"><a name="line1095"></a>1095 
</span><span class="marked1"><a name="line1096"></a>1096       def redirect_to_full_url(url, status)
</span><span class="uncovered0"><a name="line1097"></a>1097         raise DoubleRenderError if performed?
</span><span class="uncovered1"><a name="line1098"></a>1098         response.redirect(url, interpret_status(status))
</span><span class="uncovered0"><a name="line1099"></a>1099         @performed_redirect = true
</span><span class="uncovered1"><a name="line1100"></a>1100       end
</span><span class="inferred0"><a name="line1101"></a>1101 
</span><span class="inferred1"><a name="line1102"></a>1102       # Sets the etag and/or last_modified on the response and checks it against
</span><span class="inferred0"><a name="line1103"></a>1103       # the client request. If the request doesn't match the options provided, the
</span><span class="inferred1"><a name="line1104"></a>1104       # request is considered stale and should be generated from scratch. Otherwise,
</span><span class="inferred0"><a name="line1105"></a>1105       # it's fresh and we don't need to generate anything and a reply of &quot;304 Not Modified&quot; is sent.
</span><span class="inferred1"><a name="line1106"></a>1106       #
</span><span class="inferred0"><a name="line1107"></a>1107       # Example:
</span><span class="inferred1"><a name="line1108"></a>1108       #
</span><span class="inferred0"><a name="line1109"></a>1109       #   def show
</span><span class="inferred1"><a name="line1110"></a>1110       #     @article = Article.find(params[:id])
</span><span class="inferred0"><a name="line1111"></a>1111       #
</span><span class="inferred1"><a name="line1112"></a>1112       #     if stale?(:etag =&gt; @article, :last_modified =&gt; @article.created_at.utc)
</span><span class="inferred0"><a name="line1113"></a>1113       #       @statistics = @article.really_expensive_call
</span><span class="inferred1"><a name="line1114"></a>1114       #       respond_to do |format|
</span><span class="inferred0"><a name="line1115"></a>1115       #         # all the supported formats
</span><span class="inferred1"><a name="line1116"></a>1116       #       end
</span><span class="inferred0"><a name="line1117"></a>1117       #     end
</span><span class="inferred1"><a name="line1118"></a>1118       #   end
</span><span class="marked0"><a name="line1119"></a>1119       def stale?(options)
</span><span class="uncovered1"><a name="line1120"></a>1120         fresh_when(options)
</span><span class="uncovered0"><a name="line1121"></a>1121         !request.fresh?(response)
</span><span class="uncovered1"><a name="line1122"></a>1122       end
</span><span class="inferred0"><a name="line1123"></a>1123 
</span><span class="inferred1"><a name="line1124"></a>1124       # Sets the etag, last_modified, or both on the response and renders a
</span><span class="inferred0"><a name="line1125"></a>1125       # &quot;304 Not Modified&quot; response if the request is already fresh.
</span><span class="inferred1"><a name="line1126"></a>1126       #
</span><span class="inferred0"><a name="line1127"></a>1127       # Example:
</span><span class="inferred1"><a name="line1128"></a>1128       #
</span><span class="inferred0"><a name="line1129"></a>1129       #   def show
</span><span class="inferred1"><a name="line1130"></a>1130       #     @article = Article.find(params[:id])
</span><span class="inferred0"><a name="line1131"></a>1131       #     fresh_when(:etag =&gt; @article, :last_modified =&gt; @article.created_at.utc)
</span><span class="inferred1"><a name="line1132"></a>1132       #   end
</span><span class="inferred0"><a name="line1133"></a>1133       #
</span><span class="inferred1"><a name="line1134"></a>1134       # This will render the show template if the request isn't sending a matching etag or
</span><span class="inferred0"><a name="line1135"></a>1135       # If-Modified-Since header and just a &quot;304 Not Modified&quot; response if there's a match.
</span><span class="marked1"><a name="line1136"></a>1136       def fresh_when(options)
</span><span class="uncovered0"><a name="line1137"></a>1137         options.assert_valid_keys(:etag, :last_modified)
</span><span class="uncovered1"><a name="line1138"></a>1138 
</span><span class="uncovered0"><a name="line1139"></a>1139         response.etag          = options[:etag]          if options[:etag]
</span><span class="uncovered1"><a name="line1140"></a>1140         response.last_modified = options[:last_modified] if options[:last_modified]
</span><span class="uncovered0"><a name="line1141"></a>1141 
</span><span class="uncovered1"><a name="line1142"></a>1142         if request.fresh?(response)
</span><span class="uncovered0"><a name="line1143"></a>1143           head :not_modified
</span><span class="uncovered1"><a name="line1144"></a>1144         end
</span><span class="uncovered0"><a name="line1145"></a>1145       end
</span><span class="inferred1"><a name="line1146"></a>1146 
</span><span class="inferred0"><a name="line1147"></a>1147       # Sets a HTTP 1.1 Cache-Control header. Defaults to issuing a &quot;private&quot; instruction, so that
</span><span class="inferred1"><a name="line1148"></a>1148       # intermediate caches shouldn't cache the response.
</span><span class="inferred0"><a name="line1149"></a>1149       #
</span><span class="inferred1"><a name="line1150"></a>1150       # Examples:
</span><span class="inferred0"><a name="line1151"></a>1151       #   expires_in 20.minutes
</span><span class="inferred1"><a name="line1152"></a>1152       #   expires_in 3.hours, :private =&gt; false
</span><span class="inferred0"><a name="line1153"></a>1153       #   expires in 3.hours, 'max-stale' =&gt; 5.hours, :private =&gt; nil, :public =&gt; true
</span><span class="inferred1"><a name="line1154"></a>1154       #
</span><span class="inferred0"><a name="line1155"></a>1155       # This method will overwrite an existing Cache-Control header.
</span><span class="inferred1"><a name="line1156"></a>1156       # See http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html for more possibilities.
</span><span class="marked0"><a name="line1157"></a>1157       def expires_in(seconds, options = {}) #:doc:
</span><span class="uncovered1"><a name="line1158"></a>1158         cache_options = { 'max-age' =&gt; seconds, 'private' =&gt; true }.symbolize_keys.merge!(options.symbolize_keys)
</span><span class="uncovered0"><a name="line1159"></a>1159         cache_options.delete_if { |k,v| v.nil? or v == false }
</span><span class="uncovered1"><a name="line1160"></a>1160         cache_control = cache_options.map{ |k,v| v == true ? k.to_s : &quot;#{k.to_s}=#{v.to_s}&quot;}
</span><span class="uncovered0"><a name="line1161"></a>1161         response.headers[&quot;Cache-Control&quot;] = cache_control.join(', ')
</span><span class="uncovered1"><a name="line1162"></a>1162       end
</span><span class="inferred0"><a name="line1163"></a>1163 
</span><span class="inferred1"><a name="line1164"></a>1164       # Sets a HTTP 1.1 Cache-Control header of &quot;no-cache&quot; so no caching should occur by the browser or
</span><span class="inferred0"><a name="line1165"></a>1165       # intermediate caches (like caching proxy servers).
</span><span class="marked1"><a name="line1166"></a>1166       def expires_now #:doc:
</span><span class="uncovered0"><a name="line1167"></a>1167         response.headers[&quot;Cache-Control&quot;] = &quot;no-cache&quot;
</span><span class="uncovered1"><a name="line1168"></a>1168       end
</span><span class="inferred0"><a name="line1169"></a>1169 
</span><span class="inferred1"><a name="line1170"></a>1170       # Resets the session by clearing out all the objects stored within and initializing a new session object.
</span><span class="marked0"><a name="line1171"></a>1171       def reset_session #:doc:
</span><span class="uncovered1"><a name="line1172"></a>1172         request.reset_session
</span><span class="uncovered0"><a name="line1173"></a>1173         @_session = request.session
</span><span class="uncovered1"><a name="line1174"></a>1174       end
</span><span class="inferred0"><a name="line1175"></a>1175 
</span><span class="marked1"><a name="line1176"></a>1176     private
</span><span class="marked0"><a name="line1177"></a>1177       def render_for_file(template_path, status = nil, layout = nil, locals = {}) #:nodoc:
</span><span class="uncovered1"><a name="line1178"></a>1178         path = template_path.respond_to?(:path_without_format_and_extension) ? template_path.path_without_format_and_extension : template_path
</span><span class="uncovered0"><a name="line1179"></a>1179         logger.info(&quot;Rendering #{path}&quot; + (status ? &quot; (#{status})&quot; : '')) if logger
</span><span class="uncovered1"><a name="line1180"></a>1180         render_for_text @template.render(:file =&gt; template_path, :locals =&gt; locals, :layout =&gt; layout), status
</span><span class="uncovered0"><a name="line1181"></a>1181       end
</span><span class="inferred1"><a name="line1182"></a>1182 
</span><span class="marked0"><a name="line1183"></a>1183       def render_for_text(text = nil, status = nil, append_response = false) #:nodoc:
</span><span class="uncovered1"><a name="line1184"></a>1184         @performed_render = true
</span><span class="uncovered0"><a name="line1185"></a>1185 
</span><span class="uncovered1"><a name="line1186"></a>1186         response.status = interpret_status(status || DEFAULT_RENDER_STATUS_CODE)
</span><span class="uncovered0"><a name="line1187"></a>1187 
</span><span class="uncovered1"><a name="line1188"></a>1188         if append_response
</span><span class="uncovered0"><a name="line1189"></a>1189           response.body ||= ''
</span><span class="uncovered1"><a name="line1190"></a>1190           response.body &lt;&lt; text.to_s
</span><span class="uncovered0"><a name="line1191"></a>1191         else
</span><span class="uncovered1"><a name="line1192"></a>1192           response.body = case text
</span><span class="uncovered0"><a name="line1193"></a>1193             when Proc then text
</span><span class="uncovered1"><a name="line1194"></a>1194             when nil  then &quot; &quot; # Safari doesn't pass the headers of the return if the response is zero length
</span><span class="uncovered0"><a name="line1195"></a>1195             else           text.to_s
</span><span class="uncovered1"><a name="line1196"></a>1196           end
</span><span class="uncovered0"><a name="line1197"></a>1197         end
</span><span class="uncovered1"><a name="line1198"></a>1198       end
</span><span class="inferred0"><a name="line1199"></a>1199 
</span><span class="marked1"><a name="line1200"></a>1200       def validate_render_arguments(options, extra_options, has_block)
</span><span class="uncovered0"><a name="line1201"></a>1201         if options &amp;&amp; (has_block &amp;&amp; options != :update) &amp;&amp; !options.is_a?(String) &amp;&amp; !options.is_a?(Hash) &amp;&amp; !options.is_a?(Symbol)
</span><span class="uncovered1"><a name="line1202"></a>1202           raise RenderError, &quot;You called render with invalid options : #{options.inspect}&quot;
</span><span class="uncovered0"><a name="line1203"></a>1203         end
</span><span class="uncovered1"><a name="line1204"></a>1204 
</span><span class="uncovered0"><a name="line1205"></a>1205         if !extra_options.is_a?(Hash)
</span><span class="uncovered1"><a name="line1206"></a>1206           raise RenderError, &quot;You called render with invalid options : #{options.inspect}, #{extra_options.inspect}&quot;
</span><span class="uncovered0"><a name="line1207"></a>1207         end
</span><span class="uncovered1"><a name="line1208"></a>1208       end
</span><span class="inferred0"><a name="line1209"></a>1209 
</span><span class="marked1"><a name="line1210"></a>1210       def initialize_template_class(response)
</span><span class="uncovered0"><a name="line1211"></a>1211         response.template = ActionView::Base.new(self.class.view_paths, {}, self)
</span><span class="uncovered1"><a name="line1212"></a>1212         response.template.helpers.send :include, self.class.master_helper_module
</span><span class="uncovered0"><a name="line1213"></a>1213         response.redirected_to = nil
</span><span class="uncovered1"><a name="line1214"></a>1214         @performed_render = @performed_redirect = false
</span><span class="uncovered0"><a name="line1215"></a>1215       end
</span><span class="inferred1"><a name="line1216"></a>1216 
</span><span class="marked0"><a name="line1217"></a>1217       def assign_shortcuts(request, response)
</span><span class="uncovered1"><a name="line1218"></a>1218         @_request, @_params = request, request.parameters
</span><span class="uncovered0"><a name="line1219"></a>1219 
</span><span class="uncovered1"><a name="line1220"></a>1220         @_response         = response
</span><span class="uncovered0"><a name="line1221"></a>1221         @_response.session = request.session
</span><span class="uncovered1"><a name="line1222"></a>1222 
</span><span class="uncovered0"><a name="line1223"></a>1223         @_session = @_response.session
</span><span class="uncovered1"><a name="line1224"></a>1224         @template = @_response.template
</span><span class="uncovered0"><a name="line1225"></a>1225 
</span><span class="uncovered1"><a name="line1226"></a>1226         @_headers = @_response.headers
</span><span class="uncovered0"><a name="line1227"></a>1227       end
</span><span class="inferred1"><a name="line1228"></a>1228 
</span><span class="marked0"><a name="line1229"></a>1229       def initialize_current_url
</span><span class="uncovered1"><a name="line1230"></a>1230         @url = UrlRewriter.new(request, params.clone)
</span><span class="uncovered0"><a name="line1231"></a>1231       end
</span><span class="inferred1"><a name="line1232"></a>1232 
</span><span class="marked0"><a name="line1233"></a>1233       def log_processing
</span><span class="uncovered1"><a name="line1234"></a>1234         if logger &amp;&amp; logger.info?
</span><span class="uncovered0"><a name="line1235"></a>1235           log_processing_for_request_id
</span><span class="uncovered1"><a name="line1236"></a>1236           log_processing_for_parameters
</span><span class="uncovered0"><a name="line1237"></a>1237         end
</span><span class="uncovered1"><a name="line1238"></a>1238       end
</span><span class="inferred0"><a name="line1239"></a>1239 
</span><span class="marked1"><a name="line1240"></a>1240       def log_processing_for_request_id
</span><span class="uncovered0"><a name="line1241"></a>1241         request_id = &quot;\n\nProcessing #{self.class.name}\##{action_name} &quot;
</span><span class="uncovered1"><a name="line1242"></a>1242         request_id &lt;&lt; &quot;to #{params[:format]} &quot; if params[:format]
</span><span class="uncovered0"><a name="line1243"></a>1243         request_id &lt;&lt; &quot;(for #{request_origin}) [#{request.method.to_s.upcase}]&quot;
</span><span class="uncovered1"><a name="line1244"></a>1244 
</span><span class="uncovered0"><a name="line1245"></a>1245         logger.info(request_id)
</span><span class="uncovered1"><a name="line1246"></a>1246       end
</span><span class="inferred0"><a name="line1247"></a>1247 
</span><span class="marked1"><a name="line1248"></a>1248       def log_processing_for_parameters
</span><span class="uncovered0"><a name="line1249"></a>1249         parameters = respond_to?(:filter_parameters) ? filter_parameters(params) : params.dup
</span><span class="uncovered1"><a name="line1250"></a>1250         parameters = parameters.except!(:controller, :action, :format, :_method)
</span><span class="uncovered0"><a name="line1251"></a>1251 
</span><span class="uncovered1"><a name="line1252"></a>1252         logger.info &quot;  Parameters: #{parameters.inspect}&quot; unless parameters.empty?
</span><span class="uncovered0"><a name="line1253"></a>1253       end
</span><span class="inferred1"><a name="line1254"></a>1254 
</span><span class="marked0"><a name="line1255"></a>1255       def default_render #:nodoc:
</span><span class="uncovered1"><a name="line1256"></a>1256         render
</span><span class="uncovered0"><a name="line1257"></a>1257       end
</span><span class="inferred1"><a name="line1258"></a>1258 
</span><span class="marked0"><a name="line1259"></a>1259       def perform_action
</span><span class="uncovered1"><a name="line1260"></a>1260         if action_methods.include?(action_name)
</span><span class="uncovered0"><a name="line1261"></a>1261           send(action_name)
</span><span class="uncovered1"><a name="line1262"></a>1262           default_render unless performed?
</span><span class="uncovered0"><a name="line1263"></a>1263         elsif respond_to? :method_missing
</span><span class="uncovered1"><a name="line1264"></a>1264           method_missing action_name
</span><span class="uncovered0"><a name="line1265"></a>1265           default_render unless performed?
</span><span class="uncovered1"><a name="line1266"></a>1266         else
</span><span class="uncovered0"><a name="line1267"></a>1267           begin
</span><span class="uncovered1"><a name="line1268"></a>1268             default_render
</span><span class="uncovered0"><a name="line1269"></a>1269           rescue ActionView::MissingTemplate =&gt; e
</span><span class="uncovered1"><a name="line1270"></a>1270             # Was the implicit template missing, or was it another template?
</span><span class="uncovered0"><a name="line1271"></a>1271             if e.path == default_template_name
</span><span class="uncovered1"><a name="line1272"></a>1272               raise UnknownAction, &quot;No action responded to #{action_name}. Actions: #{action_methods.sort.to_sentence}&quot;, caller
</span><span class="uncovered0"><a name="line1273"></a>1273             else
</span><span class="uncovered1"><a name="line1274"></a>1274               raise e
</span><span class="uncovered0"><a name="line1275"></a>1275             end
</span><span class="uncovered1"><a name="line1276"></a>1276           end
</span><span class="uncovered0"><a name="line1277"></a>1277         end
</span><span class="uncovered1"><a name="line1278"></a>1278       end
</span><span class="inferred0"><a name="line1279"></a>1279 
</span><span class="marked1"><a name="line1280"></a>1280       def performed?
</span><span class="uncovered0"><a name="line1281"></a>1281         @performed_render || @performed_redirect
</span><span class="uncovered1"><a name="line1282"></a>1282       end
</span><span class="inferred0"><a name="line1283"></a>1283 
</span><span class="marked1"><a name="line1284"></a>1284       def assign_names
</span><span class="uncovered0"><a name="line1285"></a>1285         @action_name = (params['action'] || 'index')
</span><span class="uncovered1"><a name="line1286"></a>1286       end
</span><span class="inferred0"><a name="line1287"></a>1287 
</span><span class="marked1"><a name="line1288"></a>1288       def action_methods
</span><span class="uncovered0"><a name="line1289"></a>1289         self.class.action_methods
</span><span class="uncovered1"><a name="line1290"></a>1290       end
</span><span class="inferred0"><a name="line1291"></a>1291 
</span><span class="marked1"><a name="line1292"></a>1292       def self.action_methods
</span><span class="uncovered0"><a name="line1293"></a>1293         @action_methods ||=
</span><span class="uncovered1"><a name="line1294"></a>1294           # All public instance methods of this class, including ancestors
</span><span class="uncovered0"><a name="line1295"></a>1295           public_instance_methods(true).map { |m| m.to_s }.to_set -
</span><span class="uncovered1"><a name="line1296"></a>1296           # Except for public instance methods of Base and its ancestors
</span><span class="uncovered0"><a name="line1297"></a>1297           Base.public_instance_methods(true).map { |m| m.to_s } +
</span><span class="uncovered1"><a name="line1298"></a>1298           # Be sure to include shadowed public instance methods of this class
</span><span class="uncovered0"><a name="line1299"></a>1299           public_instance_methods(false).map { |m| m.to_s } -
</span><span class="uncovered1"><a name="line1300"></a>1300           # And always exclude explicitly hidden actions
</span><span class="uncovered0"><a name="line1301"></a>1301           hidden_actions
</span><span class="uncovered1"><a name="line1302"></a>1302       end
</span><span class="inferred0"><a name="line1303"></a>1303 
</span><span class="marked1"><a name="line1304"></a>1304       def reset_variables_added_to_assigns
</span><span class="uncovered0"><a name="line1305"></a>1305         @template.instance_variable_set(&quot;@assigns_added&quot;, nil)
</span><span class="uncovered1"><a name="line1306"></a>1306       end
</span><span class="inferred0"><a name="line1307"></a>1307 
</span><span class="marked1"><a name="line1308"></a>1308       def request_origin
</span><span class="uncovered0"><a name="line1309"></a>1309         # this *needs* to be cached!
</span><span class="uncovered1"><a name="line1310"></a>1310         # otherwise you'd get different results if calling it more than once
</span><span class="uncovered0"><a name="line1311"></a>1311         @request_origin ||= &quot;#{request.remote_ip} at #{Time.now.to_s(:db)}&quot;
</span><span class="uncovered1"><a name="line1312"></a>1312       end
</span><span class="inferred0"><a name="line1313"></a>1313 
</span><span class="marked1"><a name="line1314"></a>1314       def complete_request_uri
</span><span class="uncovered0"><a name="line1315"></a>1315         &quot;#{request.protocol}#{request.host}#{request.request_uri}&quot;
</span><span class="uncovered1"><a name="line1316"></a>1316       end
</span><span class="inferred0"><a name="line1317"></a>1317 
</span><span class="marked1"><a name="line1318"></a>1318       def default_template(action_name = self.action_name)
</span><span class="uncovered0"><a name="line1319"></a>1319         self.view_paths.find_template(default_template_name(action_name), default_template_format)
</span><span class="uncovered1"><a name="line1320"></a>1320       end
</span><span class="inferred0"><a name="line1321"></a>1321 
</span><span class="marked1"><a name="line1322"></a>1322       def default_template_name(action_name = self.action_name)
</span><span class="uncovered0"><a name="line1323"></a>1323         if action_name
</span><span class="uncovered1"><a name="line1324"></a>1324           action_name = action_name.to_s
</span><span class="uncovered0"><a name="line1325"></a>1325           if action_name.include?('/') &amp;&amp; template_path_includes_controller?(action_name)
</span><span class="uncovered1"><a name="line1326"></a>1326             action_name = strip_out_controller(action_name)
</span><span class="uncovered0"><a name="line1327"></a>1327           end
</span><span class="uncovered1"><a name="line1328"></a>1328         end
</span><span class="uncovered0"><a name="line1329"></a>1329         &quot;#{self.controller_path}/#{action_name}&quot;
</span><span class="uncovered1"><a name="line1330"></a>1330       end
</span><span class="inferred0"><a name="line1331"></a>1331 
</span><span class="marked1"><a name="line1332"></a>1332       def strip_out_controller(path)
</span><span class="uncovered0"><a name="line1333"></a>1333         path.split('/', 2).last
</span><span class="uncovered1"><a name="line1334"></a>1334       end
</span><span class="inferred0"><a name="line1335"></a>1335 
</span><span class="marked1"><a name="line1336"></a>1336       def template_path_includes_controller?(path)
</span><span class="uncovered0"><a name="line1337"></a>1337         self.controller_path.split('/')[-1] == path.split('/')[0]
</span><span class="uncovered1"><a name="line1338"></a>1338       end
</span><span class="inferred0"><a name="line1339"></a>1339 
</span><span class="marked1"><a name="line1340"></a>1340       def process_cleanup
</span><span class="inferred0"><a name="line1341"></a>1341       end
</span><span class="inferred1"><a name="line1342"></a>1342   end
</span><span class="inferred0"><a name="line1343"></a>1343 
</span><span class="marked1"><a name="line1344"></a>1344   Base.class_eval do
</span><span class="marked0"><a name="line1345"></a>1345     [ Filters, Layout, Benchmarking, Rescue, Flash, MimeResponds, Helpers,
</span><span class="inferred1"><a name="line1346"></a>1346       Cookies, Caching, Verification, Streaming, SessionManagement,
</span><span class="inferred0"><a name="line1347"></a>1347       HttpAuthentication::Basic::ControllerMethods, HttpAuthentication::Digest::ControllerMethods,
</span><span class="inferred1"><a name="line1348"></a>1348       RecordIdentifier, RequestForgeryProtection, Translation
</span><span class="inferred0"><a name="line1349"></a>1349     ].each do |mod|
</span><span class="marked1"><a name="line1350"></a>1350       include mod
</span><span class="inferred0"><a name="line1351"></a>1351     end
</span><span class="inferred1"><a name="line1352"></a>1352   end
</span><span class="inferred0"><a name="line1353"></a>1353 end
</span></pre><hr/>
    <p>Generated using the <a href='http://eigenclass.org/hiki.rb?rcov'>rcov code coverage analysis tool for Ruby</a>
   version 0.8.1.2.</p>
<p><a href='http://validator.w3.org/check/referer'><img src='http://www.w3.org/Icons/valid-xhtml10' height='31' alt='Valid XHTML 1.0!' width='88'/>
        </a>
      <a href='http://jigsaw.w3.org/css-validator/check/referer'><img src='http://jigsaw.w3.org/css-validator/images/vcss' alt='Valid CSS!' style='border:0;width:88px;height:31px'/>
        </a>
      </p>
    </body>
  </html>
